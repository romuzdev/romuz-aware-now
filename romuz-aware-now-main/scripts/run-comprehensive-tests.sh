#!/bin/bash
# =============================================================================
# Comprehensive Test Runner for Romuz Awareness System
# ุชุดุบูู ุฌููุน ุฃููุงุน ุงูุงุฎุชุจุงุฑุงุช ุจุดูู ุดุงูู ูููุธู
# =============================================================================

set -e  # Exit on error

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Counters
TOTAL_TESTS=0
PASSED_TESTS=0
FAILED_TESTS=0

echo -e "${BLUE}=======================================${NC}"
echo -e "${BLUE}๐งช ุฎุทุฉ ุงูุงุฎุชุจุงุฑ ุงูุดุงููุฉ - Romuz System${NC}"
echo -e "${BLUE}=======================================${NC}"
echo ""

# =============================================================================
# 1๏ธโฃ UNIT TESTS (40% ูู ุงูุงุฎุชุจุงุฑุงุช)
# =============================================================================
echo -e "${YELLOW}[1/5] ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงููุญุฏุงุช (Unit Tests)...${NC}"
echo "--------------------------------------------"

if npm run test:unit; then
  echo -e "${GREEN}โ ุงุฎุชุจุงุฑุงุช ุงููุญุฏุงุช ูุฌุญุช${NC}"
  PASSED_TESTS=$((PASSED_TESTS + 1))
else
  echo -e "${RED}โ ุงุฎุชุจุงุฑุงุช ุงููุญุฏุงุช ูุดูุช${NC}"
  FAILED_TESTS=$((FAILED_TESTS + 1))
fi
TOTAL_TESTS=$((TOTAL_TESTS + 1))
echo ""

# =============================================================================
# 2๏ธโฃ INTEGRATION TESTS (30% ูู ุงูุงุฎุชุจุงุฑุงุช)
# =============================================================================
echo -e "${YELLOW}[2/5] ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงูุชูุงูู (Integration Tests)...${NC}"
echo "--------------------------------------------"

if npm run test:integration; then
  echo -e "${GREEN}โ ุงุฎุชุจุงุฑุงุช ุงูุชูุงูู ูุฌุญุช${NC}"
  PASSED_TESTS=$((PASSED_TESTS + 1))
else
  echo -e "${RED}โ ุงุฎุชุจุงุฑุงุช ุงูุชูุงูู ูุดูุช${NC}"
  FAILED_TESTS=$((FAILED_TESTS + 1))
fi
TOTAL_TESTS=$((TOTAL_TESTS + 1))
echo ""

# =============================================================================
# 3๏ธโฃ E2E TESTS (20% ูู ุงูุงุฎุชุจุงุฑุงุช)
# =============================================================================
echo -e "${YELLOW}[3/5] ุชุดุบูู ุงุฎุชุจุงุฑุงุช E2E (Playwright)...${NC}"
echo "--------------------------------------------"

if npm run test:e2e; then
  echo -e "${GREEN}โ ุงุฎุชุจุงุฑุงุช E2E ูุฌุญุช${NC}"
  PASSED_TESTS=$((PASSED_TESTS + 1))
else
  echo -e "${RED}โ ุงุฎุชุจุงุฑุงุช E2E ูุดูุช${NC}"
  FAILED_TESTS=$((FAILED_TESTS + 1))
fi
TOTAL_TESTS=$((TOTAL_TESTS + 1))
echo ""

# =============================================================================
# 4๏ธโฃ SECURITY TESTS (5% ูู ุงูุงุฎุชุจุงุฑุงุช)
# =============================================================================
echo -e "${YELLOW}[4/5] ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงูุฃูุงู (Security Tests)...${NC}"
echo "--------------------------------------------"

if npm run test:security; then
  echo -e "${GREEN}โ ุงุฎุชุจุงุฑุงุช ุงูุฃูุงู ูุฌุญุช${NC}"
  PASSED_TESTS=$((PASSED_TESTS + 1))
else
  echo -e "${RED}โ ุงุฎุชุจุงุฑุงุช ุงูุฃูุงู ูุดูุช${NC}"
  FAILED_TESTS=$((FAILED_TESTS + 1))
fi
TOTAL_TESTS=$((TOTAL_TESTS + 1))
echo ""

# =============================================================================
# 5๏ธโฃ PERFORMANCE TESTS (5% ูู ุงูุงุฎุชุจุงุฑุงุช)
# =============================================================================
echo -e "${YELLOW}[5/5] ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงูุฃุฏุงุก (Performance Tests)...${NC}"
echo "--------------------------------------------"

if npm run test:performance; then
  echo -e "${GREEN}โ ุงุฎุชุจุงุฑุงุช ุงูุฃุฏุงุก ูุฌุญุช${NC}"
  PASSED_TESTS=$((PASSED_TESTS + 1))
else
  echo -e "${RED}โ ุงุฎุชุจุงุฑุงุช ุงูุฃุฏุงุก ูุดูุช${NC}"
  FAILED_TESTS=$((FAILED_TESTS + 1))
fi
TOTAL_TESTS=$((TOTAL_TESTS + 1))
echo ""

# =============================================================================
# FINAL SUMMARY
# =============================================================================
echo -e "${BLUE}=======================================${NC}"
echo -e "${BLUE}๐ ููุฎุต ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช${NC}"
echo -e "${BLUE}=======================================${NC}"
echo ""
echo -e "ุฅุฌูุงูู ุงููุฌููุนุงุช: ${TOTAL_TESTS}"
echo -e "${GREEN}โ ูุฌุญ: ${PASSED_TESTS}${NC}"
echo -e "${RED}โ ูุดู: ${FAILED_TESTS}${NC}"
echo ""

# Calculate success rate
SUCCESS_RATE=$((PASSED_TESTS * 100 / TOTAL_TESTS))
echo -e "ูุณุจุฉ ุงููุฌุงุญ: ${SUCCESS_RATE}%"
echo ""

if [ $FAILED_TESTS -eq 0 ]; then
  echo -e "${GREEN}๐ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช! ูููู ุงูุงูุชูุงู ูููุดุฑ.${NC}"
  exit 0
else
  echo -e "${RED}โ๏ธ  ููุฌุฏ ุงุฎุชุจุงุฑุงุช ูุงุดูุฉ. ูุฑุฌู ุฅุตูุงุญูุง ูุจู ุงููุดุฑ.${NC}"
  exit 1
fi
