# ğŸ“‹ Ø®Ø·Ø© Ø§Ù„ØªÙˆØ³Ø¹ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© v1.0
## Ø®Ø·Ø© Ø¹Ù…Ù„ Ø´Ø§Ù…Ù„Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡

**Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:** Romuz Cybersecurity Culture Platform  
**Ø§Ù„ØªØ§Ø±ÙŠØ®:** 2025-11-14  
**Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªÙ†ÙÙŠØ°  
**Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©:** 24 Ø³Ø§Ø¹Ø© Ø¹Ù…Ù„ (Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1)  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** ğŸ”´ Ø­Ø±Ø¬Ø© (Critical)

---

## ğŸ“ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©

Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø© ØªÙ†ÙØ° Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„Ù…ÙˆØ¶Ø­Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Core Platform                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Auth â”‚  â”‚ User â”‚  â”‚ RBAC â”‚  â”‚Tenantâ”‚  â”‚Sharedâ”‚  â”‚ Intg â”‚  â”‚
â”‚  â”‚      â”‚  â”‚ Mgmt â”‚  â”‚      â”‚  â”‚      â”‚  â”‚Serv. â”‚  â”‚      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Application Modules                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚Documentsâ”‚ â”‚Reports â”‚ â”‚ Alerts â”‚ â”‚Content â”‚ â”‚  KPIs  â”‚       â”‚
â”‚  â”‚        â”‚ â”‚        â”‚ â”‚        â”‚ â”‚  Hub   â”‚ â”‚        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Applications                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚Awarenesâ”‚ â”‚Phishingâ”‚ â”‚  LMS   â”‚ â”‚  GRC   â”‚ â”‚ Other  â”‚       â”‚
â”‚  â”‚        â”‚ â”‚Simulatrâ”‚ â”‚        â”‚ â”‚        â”‚ â”‚  Apps  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ØªØ£Ø³ÙŠØ³ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©

### Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
> **ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ø­Ø¯ Ø¥Ù„Ù‰ Ù…Ù†ØµØ© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ÙƒØ³Ø± Ø£ÙŠ Ø´ÙŠØ¡ Ù…ÙˆØ¬ÙˆØ¯**

### Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙØ±Ø¹ÙŠØ©
1. âœ… **ÙØµÙ„ ÙˆØ§Ø¶Ø­** Ø¨ÙŠÙ† Core/Modules/Apps ÙÙŠ Ø§Ù„ÙƒÙˆØ¯
2. âœ… **Ù†Ø¸Ø§Ù… ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø±Ù†** ÙŠØ¯Ø¹Ù… ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
3. âœ… **App Registry Ù…Ø±ÙƒØ²ÙŠ** Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
4. âœ… **Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©** ØªØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
5. âœ… **Content Hub ÙƒØ§Ù…Ù„** (Ø¥ÙƒÙ…Ø§Ù„ 75% Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ)

### Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­
- [ ] Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­
- [ ] Ù„Ø§ ÙŠÙˆØ¬Ø¯ breaking changes ÙÙŠ Ø§Ù„Ù€ API
- [ ] Performance Ù„Ù… ÙŠØªØ£Ø«Ø± Ø³Ù„Ø¨Ø§Ù‹
- [ ] Ø¥Ø¶Ø§ÙØ© ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯ ØªØ³ØªØºØ±Ù‚ < 4 Ø³Ø§Ø¹Ø§Øª

---

## ğŸ“Š Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Current State Audit)

### âœ… Ù…Ø§ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ù…ØªØ§Ø² (85%)

#### 1. Multi-Tenancy âœ… 100%
```
âœ“ Ø¬Ø¯Ø§ÙˆÙ„: tenants, user_tenants, tenant_settings
âœ“ RLS policies ÙƒØ§Ù…Ù„Ø© ÙˆØ¢Ù…Ù†Ø©
âœ“ Ø¹Ø²Ù„ ØªØ§Ù… Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†
âœ“ get_user_tenant_id() function ØªØ¹Ù…Ù„
```

#### 2. Authentication âœ… 100%
```
âœ“ JWT + Session Management
âœ“ MFA Support
âœ“ profiles table Ù…ÙˆØ¬ÙˆØ¯
âœ“ Password policies
```

#### 3. Basic RBAC âš ï¸ 80%
```
âœ“ roles enum Ù…ÙˆØ¬ÙˆØ¯
âœ“ user_roles table Ù…ÙˆØ¬ÙˆØ¯
âœ“ has_role() function ØªØ¹Ù…Ù„
âœ“ RoleGuard component Ù…ÙˆØ¬ÙˆØ¯
âœ— Ù„Ø§ ÙŠØ¯Ø¹Ù… resource-based permissions (ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†)
```

#### 4. Shared Services âš ï¸ 70%
```
âœ“ Documents (90%): documents, document_versions, attachments
âœ“ Audit Log (100%): audit_log
âœ“ Alerts (85%): alert_policies, alert_channels, alert_events
âœ— Reports (80%): Ù…ØªÙØ±Ù‚Ø© ØªØ­ØªØ§Ø¬ consolidation
âœ— Content Hub (25%): ÙÙ‚Ø· campaign_modules Ù…ÙˆØ¬ÙˆØ¯
```

#### 5. UI Components âœ… 95%
```
âœ“ Shadcn/UI ÙƒØ§Ù…Ù„Ø©
âœ“ RTL + i18n
âœ“ Design System
âœ“ Shared components
```

### âš ï¸ Ù…Ø§ ÙŠØ­ØªØ§Ø¬ Ø¹Ù…Ù„ (Ø§Ù„ÙØ¬ÙˆØ§Øª)

#### 1. Code Structure âŒ 40%
```
Problem:
- ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ src/ Ø¨Ø¯ÙˆÙ† ØªÙ†Ø¸ÙŠÙ… ÙˆØ§Ø¶Ø­
- Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØµÙ„ Ø¨ÙŠÙ† Core/Modules/Apps
- Imports Ù…Ø¹Ù‚Ø¯Ø© ÙˆÙ…ØªØ´Ø§Ø¨ÙƒØ©

Impact: ØµØ¹Ø¨ Ø¥Ø¶Ø§ÙØ© ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
Priority: ğŸ”´ P0 Critical
```

#### 2. Permission System âŒ 50%
```
Problem:
- ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ø³ÙŠØ·Ø© Ø¬Ø¯Ø§Ù‹ (admin, user, viewer)
- Ù„Ø§ ÙŠØ¯Ø¹Ù… ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø«Ù„: awareness.campaign.create

Impact: ÙƒÙ„ ØªØ·Ø¨ÙŠÙ‚ ÙŠØ­ØªØ§Ø¬ Ù†Ø¸Ø§Ù… ØµÙ„Ø§Ø­ÙŠØ§Øª Ø®Ø§Øµ Ø¨Ù‡
Priority: ğŸ”´ P0 Critical
```

#### 3. App Registry âŒ 0%
```
Problem:
- Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø¸Ø§Ù… Ù…Ø±ÙƒØ²ÙŠ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© hardcoded

Impact: ØµØ¹Ø¨ Ø¥Ø¶Ø§ÙØ©/Ø¥Ø²Ø§Ù„Ø© ØªØ·Ø¨ÙŠÙ‚Ø§Øª
Priority: ğŸ”´ P0 Critical
```

#### 4. Content Hub âŒ 25%
```
Problem:
- ÙÙ‚Ø· campaign_modules Ù…ÙˆØ¬ÙˆØ¯
- 7 Ø¬Ø¯Ø§ÙˆÙ„ Ù…ÙÙ‚ÙˆØ¯Ø© (contents, quiz_templates, etc.)

Impact: M4 ØºÙŠØ± Ù…ÙƒØªÙ…Ù„
Priority: ğŸŸ¡ P1 High
```

---

## ğŸš€ Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…ÙØµÙ„Ø©

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Foundation (24 Ø³Ø§Ø¹Ø©)

---

## ğŸ“¦ Part 1.1: Code Restructuring (4 Ø³Ø§Ø¹Ø§Øª)

### Ø§Ù„Ù‡Ø¯Ù
> Ø¥Ø¹Ø§Ø¯Ø© ØªÙ†Ø¸ÙŠÙ… Ø§Ù„ÙƒÙˆØ¯ Ù„ÙØµÙ„ Core Ø¹Ù† Modules Ø¹Ù† Apps Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­

### Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©

```
src/
â”œâ”€â”€ core/                           # â­ NEW - Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
â”‚   â”œâ”€â”€ auth/                      # Authentication utilities
â”‚   â”‚   â”œâ”€â”€ AuthProvider.tsx
â”‚   â”‚   â”œâ”€â”€ authHelpers.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ rbac/                      # Enhanced RBAC
â”‚   â”‚   â”œâ”€â”€ RoleGuard.tsx
â”‚   â”‚   â”œâ”€â”€ PermissionGuard.tsx   # NEW
â”‚   â”‚   â”œâ”€â”€ usePermissions.ts     # NEW
â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ tenancy/                   # Multi-tenant helpers
â”‚   â”‚   â”œâ”€â”€ useTenant.ts
â”‚   â”‚   â”œâ”€â”€ TenantProvider.tsx
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ services/                  # Shared services
â”‚   â”‚   â”œâ”€â”€ documentService.ts    # MOVE from src/services/
â”‚   â”‚   â”œâ”€â”€ attachmentService.ts  # MOVE from src/services/
â”‚   â”‚   â”œâ”€â”€ auditService.ts       # NEW
â”‚   â”‚   â”œâ”€â”€ alertService.ts       # NEW
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ config/                    # Core config
â”‚   â”‚   â”œâ”€â”€ appRegistry.ts        # NEW - App Registry
â”‚   â”‚   â”œâ”€â”€ constants.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ hooks/                     # Core hooks
â”‚   â”‚   â”œâ”€â”€ useAppModules.ts      # NEW
â”‚   â”‚   â”œâ”€â”€ useAppFeatures.ts     # NEW
â”‚   â”‚   â”œâ”€â”€ usePermissions.ts     # NEW
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ components/                # Core UI components
â”‚   â”‚   â”œâ”€â”€ PermissionGuard.tsx   # NEW
â”‚   â”‚   â”œâ”€â”€ ErrorBoundary.tsx
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ index.ts                   # Barrel export
â”‚
â”œâ”€â”€ modules/                        # â­ NEW - Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
â”‚   â”œâ”€â”€ campaigns/                 # M2 - Campaign Management
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ campaign.types.ts
â”‚   â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”‚   â””â”€â”€ campaigns.integration.ts
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useCampaignsList.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useCampaignById.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ CampaignCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StatusBadge.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ content-hub/               # M4 - Content Hub (NEW)
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ culture-index/             # M3 - Culture KPIs
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ documents/                 # M10 - Documents & Reports
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ alerts/                    # M8 - Alerts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ apps/                           # â­ NEW - Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
â”‚   â”œâ”€â”€ awareness/                 # Awareness App
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ campaigns/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx     # MOVE from src/pages/admin/campaigns/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ [id].tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ create.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ participants/
â”‚   â”‚   â”‚   â”œâ”€â”€ reports/
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ routes.tsx             # App-specific routes
â”‚   â”‚   â”œâ”€â”€ config.ts              # App config
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ lms/                        # LMS (Future)
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ routes.tsx
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ phishing/                   # Phishing Simulator (Future)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ grc/                        # GRC Platform (Future)
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ components/                     # Shared UI Components (KEEP)
â”‚   â”œâ”€â”€ ui/                        # shadcn components
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ layouts/                        # Layouts (KEEP)
â”‚   â”œâ”€â”€ AppSidebar.tsx             # Will be updated
â”‚   â”œâ”€â”€ AppLayout.tsx
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ lib/                            # Utilities (KEEP)
â”‚   â”œâ”€â”€ utils.ts
â”‚   â”œâ”€â”€ app-context/               # KEEP
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ types/                          # Global TypeScript types (KEEP)
â”‚   â”œâ”€â”€ supabase.ts
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ App.tsx                         # Main App (KEEP)
â”œâ”€â”€ main.tsx                        # Entry point (KEEP)
â””â”€â”€ index.css                       # Global styles (KEEP)
```

### Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©

#### Step 1.1.1: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (30 Ø¯Ù‚ÙŠÙ‚Ø©)

**Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª:**
```bash
# 1. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
mkdir -p src/core/{auth,rbac,tenancy,services,config,hooks,components}
mkdir -p src/modules/{campaigns,content-hub,culture-index,documents,alerts}
mkdir -p src/apps/{awareness,lms,phishing,grc}

# 2. Ø¥Ù†Ø´Ø§Ø¡ index.ts Ù„ÙƒÙ„ Ù…Ø¬Ù„Ø¯ (barrel exports)
touch src/core/index.ts
touch src/modules/index.ts
touch src/apps/index.ts
```

**Verification Checklist:**
- [ ] Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
- [ ] Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ index.ts Ù…ÙˆØ¬ÙˆØ¯Ø©
- [ ] Ø§Ù„Ø¨Ù†ÙŠØ© ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø®Ø·Ø· Ø£Ø¹Ù„Ø§Ù‡

#### Step 1.1.2: Ù†Ù‚Ù„ Core Services (60 Ø¯Ù‚ÙŠÙ‚Ø©)

**Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª:**

1. **Ù†Ù‚Ù„ Authentication:**
```typescript
// Move: src/lib/rbac/ â†’ src/core/auth/
// Files:
// - AuthProvider.tsx â†’ keep and enhance
// - authHelpers.ts
```

2. **Ù†Ù‚Ù„ RBAC:**
```typescript
// Move: src/lib/rbac/ â†’ src/core/rbac/
// Files:
// - RoleGuard.tsx
// - useRBAC.ts â†’ will be enhanced to usePermissions.ts
// - types.ts
```

3. **Ù†Ù‚Ù„ Services:**
```typescript
// Move: src/services/ â†’ src/core/services/
// Files:
// - documentService.ts
// - attachmentService.ts
// Update: src/services/index.ts â†’ src/core/services/index.ts
```

**Code Changes:**

```typescript
// src/core/services/index.ts
export * from './documentService';
export * from './attachmentService';
export * from './auditService';
export * from './alertService';
```

**Update Imports:** (Critical!)
```typescript
// Before:
import { documentService } from '@/services';
import { useCan } from '@/lib/rbac';

// After:
import { documentService } from '@/core/services';
import { useCan } from '@/core/rbac';
```

**Verification Checklist:**
- [ ] Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù†Ù‚ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­
- [ ] Ù„Ø§ ÙŠÙˆØ¬Ø¯ import errors
- [ ] Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡
- [ ] Tests ØªØ¹Ù…Ù„

**Rollback Plan:**
Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ù†Ù‚Ù„:
```bash
git checkout HEAD -- src/services/
git checkout HEAD -- src/lib/rbac/
```

#### Step 1.1.3: Ù†Ù‚Ù„ Modules (90 Ø¯Ù‚ÙŠÙ‚Ø©)

**Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª:**

1. **Ø¥Ù†Ø´Ø§Ø¡ campaigns module:**
```typescript
// Move:
// src/integrations/supabase/campaigns.ts â†’ src/modules/campaigns/integration/
// src/hooks/campaigns/* â†’ src/modules/campaigns/hooks/
// src/types/campaigns.ts â†’ src/modules/campaigns/types/
// src/components/campaigns/* â†’ src/modules/campaigns/components/
```

2. **Structure:**
```
src/modules/campaigns/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ campaign.types.ts          # MOVE from src/types/campaigns.ts
â”œâ”€â”€ integration/
â”‚   â””â”€â”€ campaigns.integration.ts   # MOVE from src/integrations/supabase/campaigns.ts
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useCampaignsList.ts        # MOVE from src/hooks/campaigns/
â”‚   â”œâ”€â”€ useCampaignById.ts
â”‚   â”œâ”€â”€ useUpsertCampaign.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ CampaignCard.tsx           # MOVE from src/components/campaigns/
â”‚   â”œâ”€â”€ StatusBadge.tsx
â”‚   â””â”€â”€ index.ts
â””â”€â”€ index.ts                        # Barrel export
```

3. **Create barrel export:**
```typescript
// src/modules/campaigns/index.ts
export * from './types/campaign.types';
export * from './integration/campaigns.integration';
export * from './hooks';
export * from './components';
```

**Verification Checklist:**
- [ ] campaigns module Ù…ÙƒØªÙ…Ù„
- [ ] Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ imports Ù…Ø­Ø¯Ø«Ø©
- [ ] Ù„Ø§ ÙŠÙˆØ¬Ø¯ circular dependencies
- [ ] Campaign pages ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­

#### Step 1.1.4: Ù†Ù‚Ù„ Apps (90 Ø¯Ù‚ÙŠÙ‚Ø©)

**Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª:**

1. **Create awareness app structure:**
```
src/apps/awareness/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ campaigns/
â”‚   â”‚   â”œâ”€â”€ index.tsx              # MOVE from src/pages/admin/campaigns/index.tsx
â”‚   â”‚   â”œâ”€â”€ [id].tsx               # MOVE from src/pages/admin/campaigns/[id].tsx
â”‚   â”‚   â””â”€â”€ create.tsx
â”‚   â”œâ”€â”€ participants/
â”‚   â”œâ”€â”€ reports/
â”‚   â””â”€â”€ index.tsx
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ routes.tsx
â”œâ”€â”€ config.ts
â””â”€â”€ index.ts
```

2. **Create routes file:**
```typescript
// src/apps/awareness/routes.tsx
import { lazy } from 'react';

const CampaignsPage = lazy(() => import('./pages/campaigns'));
const CampaignDetailPage = lazy(() => import('./pages/campaigns/[id]'));

export const awarenessRoutes = [
  {
    path: '/app/awareness/campaigns',
    element: <CampaignsPage />,
    permission: 'awareness.campaign.view',
  },
  {
    path: '/app/awareness/campaigns/:id',
    element: <CampaignDetailPage />,
    permission: 'awareness.campaign.view',
  },
];
```

3. **Update main App.tsx:**
```typescript
// src/App.tsx
import { awarenessRoutes } from '@/apps/awareness/routes';

function App() {
  return (
    <Routes>
      <Route path="/" element={<LandingPage />} />
      <Route path="/login" element={<LoginPage />} />
      
      {awarenessRoutes.map(route => (
        <Route 
          key={route.path} 
          path={route.path} 
          element={
            <PermissionGuard permission={route.permission}>
              {route.element}
            </PermissionGuard>
          } 
        />
      ))}
    </Routes>
  );
}
```

**Verification Checklist:**
- [ ] awareness app Ù…Ù†Ø¸Ù… Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
- [ ] Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª ØªØ¹Ù…Ù„
- [ ] Routing ÙŠØ¹Ù…Ù„
- [ ] Permissions ØªØ¹Ù…Ù„ (Ø³ÙŠØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡Ø§ ÙÙŠ Part 1.3)

#### Step 1.1.5: Update Imports ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª (60 Ø¯Ù‚ÙŠÙ‚Ø©)

**Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©:**

1. **Ø§Ø³ØªØ®Ø¯Ø§Ù… Find & Replace:**
```typescript
// Pattern 1: Services
Find:    import { documentService } from '@/services'
Replace: import { documentService } from '@/core/services'

// Pattern 2: RBAC
Find:    import { useCan } from '@/lib/rbac'
Replace: import { useCan } from '@/core/rbac'

// Pattern 3: Campaigns
Find:    import { Campaign } from '@/types/campaigns'
Replace: import { Campaign } from '@/modules/campaigns'

Find:    import { useCampaignsList } from '@/hooks/campaigns'
Replace: import { useCampaignsList } from '@/modules/campaigns'
```

2. **Verify No Errors:**
```bash
# Run TypeScript compiler
npm run type-check

# Run ESLint
npm run lint

# Run tests
npm run test
```

**Verification Checklist:**
- [ ] Ù„Ø§ ÙŠÙˆØ¬Ø¯ TypeScript errors
- [ ] Ù„Ø§ ÙŠÙˆØ¬Ø¯ ESLint errors
- [ ] Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ Tests ØªØ¹Ù…Ù„
- [ ] Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ ÙÙŠ Dev mode

### Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø­Ø±Ø¬Ø© (Critical Verification Points)

#### âœ… Checkpoint 1.1.A: Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ù†ÙŠØ©
```bash
# Test: Check folder structure
tree src/ -L 2

# Expected output should match target structure
# If not, rollback and retry
```

#### âœ… Checkpoint 1.1.B: Ø¨Ø¹Ø¯ Ù†Ù‚Ù„ Core Services
```bash
# Test: Run dev server
npm run dev

# Test: Check console for errors
# Expected: No import errors

# Test: Navigate to any page
# Expected: Page loads without errors
```

#### âœ… Checkpoint 1.1.C: Ø¨Ø¹Ø¯ Ù†Ù‚Ù„ Modules
```bash
# Test: Campaign pages
# Navigate to /app/awareness/campaigns
# Expected: List loads correctly

# Test: Create campaign
# Expected: Form works correctly
```

#### âœ… Checkpoint 1.1.D: Ø¨Ø¹Ø¯ Ù†Ù‚Ù„ Apps
```bash
# Test: All app routes
# Expected: All pages accessible

# Test: Permissions (basic)
# Expected: RoleGuard still works
```

#### âœ… Checkpoint 1.1.E: Final Check
```bash
# Run full test suite
npm run test

# Run E2E tests (if available)
npm run test:e2e

# Check build
npm run build

# Expected: All pass
```

### Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

1. **Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Branch Ù…Ù†ÙØµÙ„:**
```bash
git checkout -b feature/platform-restructure
```

2. **Commit Ø¨Ø¹Ø¯ ÙƒÙ„ Ø®Ø·ÙˆØ©:**
```bash
git add .
git commit -m "feat: create core/modules/apps structure"
```

3. **Testing Ù…Ø³ØªÙ…Ø±:**
- Ø¨Ø¹Ø¯ ÙƒÙ„ Ù†Ù‚Ù„ØŒ Ø§Ø®ØªØ¨Ø± Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©
- Ù„Ø§ ØªÙ†ØªÙ‚Ù„ Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯

4. **Backup Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡:**
```bash
git branch backup/before-restructure
```

### Rollback Plan

Ø¥Ø°Ø§ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø£ÙŠ Ù…Ø±Ø­Ù„Ø©:

```bash
# Option 1: Rollback to last working commit
git reset --hard HEAD~1

# Option 2: Rollback to backup branch
git reset --hard backup/before-restructure

# Option 3: Cherry-pick successful commits
git cherry-pick <commit-hash>
```

### Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù‚Ø¨ÙˆÙ„ (Acceptance Criteria)

- [ ] âœ… Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø®Ø·Ø·
- [ ] âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù†Ù‚ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­
- [ ] âœ… Ù„Ø§ ÙŠÙˆØ¬Ø¯ import errors
- [ ] âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª ØªØ¹Ù…Ù„
- [ ] âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ Tests ØªØ¹Ù…Ù„
- [ ] âœ… Build ÙŠÙ†Ø¬Ø­ Ø¨Ø¯ÙˆÙ† warnings
- [ ] âœ… Performance Ù„Ù… ÙŠØªØ£Ø«Ø± Ø³Ù„Ø¨Ø§Ù‹
- [ ] âœ… Ø§Ù„ÙƒÙˆØ¯ Ø£ÙƒØ«Ø± ØªÙ†Ø¸ÙŠÙ…Ø§Ù‹ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©

### Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±: 4 Ø³Ø§Ø¹Ø§Øª
- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ù†ÙŠØ©: 30 Ø¯Ù‚ÙŠÙ‚Ø©
- Ù†Ù‚Ù„ Core Services: 60 Ø¯Ù‚ÙŠÙ‚Ø©
- Ù†Ù‚Ù„ Modules: 90 Ø¯Ù‚ÙŠÙ‚Ø©
- Ù†Ù‚Ù„ Apps: 90 Ø¯Ù‚ÙŠÙ‚Ø©
- Update Imports: 60 Ø¯Ù‚ÙŠÙ‚Ø©
- **Total:** 270 Ø¯Ù‚ÙŠÙ‚Ø© = 4.5 Ø³Ø§Ø¹Ø© (buffer 30 Ø¯Ù‚ÙŠÙ‚Ø©)

---

## ğŸ“¦ Part 1.2: App Registry System (3 Ø³Ø§Ø¹Ø§Øª)

### Ø§Ù„Ù‡Ø¯Ù
> Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø¸Ø§Ù… Ù…Ø±ÙƒØ²ÙŠ Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©

### Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª
1. `appRegistry.ts` - ØªØ¹Ø±ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
2. `useAppModules` hook - Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
3. `useAppFeatures` hook - Ù…ÙŠØ²Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠ

### Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°

#### Step 1.2.1: Ø¥Ù†Ø´Ø§Ø¡ Types (15 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/config/types.ts

import type { LucideIcon } from 'lucide-react';

/**
 * App Module - ØªÙ…Ø«ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©
 */
export interface AppModule {
  /** Unique identifier */
  id: string;
  
  /** Display name (English) */
  name: string;
  
  /** Display name (Arabic) */
  nameAr: string;
  
  /** Short description */
  description: string;
  
  /** App icon */
  icon: LucideIcon;
  
  /** Base route (e.g., '/app/awareness') */
  route: string;
  
  /** Required permission to access app */
  requiredPermission: string;
  
  /** Brand color (HSL) */
  color: string;
  
  /** App status */
  status: 'active' | 'beta' | 'coming_soon' | 'deprecated';
  
  /** App features/pages */
  features: AppFeature[];
  
  /** Other apps this depends on */
  dependencies?: string[];
  
  /** Metadata */
  metadata?: {
    version?: string;
    lastUpdated?: string;
    owner?: string;
  };
}

/**
 * App Feature - ØµÙØ­Ø© Ø£Ùˆ Ù…ÙŠØ²Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
 */
export interface AppFeature {
  /** Unique identifier within app */
  id: string;
  
  /** Display name */
  name: string;
  
  /** Display name (Arabic) */
  nameAr: string;
  
  /** Feature route */
  route: string;
  
  /** Feature icon */
  icon: LucideIcon;
  
  /** Required permission */
  requiredPermission: string;
  
  /** Show in sidebar */
  showInSidebar?: boolean;
  
  /** Order in sidebar */
  order?: number;
}
```

#### Step 1.2.2: Ø¥Ù†Ø´Ø§Ø¡ App Registry (45 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/config/appRegistry.ts

import {
  Target,
  Megaphone,
  Users,
  BarChart3,
  FileText,
  Settings,
  GraduationCap,
  BookOpen,
  UserCheck,
  Award,
  Fish,
  Mail,
  MousePointer,
  TrendingUp,
  Shield,
  FileCheck,
  Scale,
  AlertTriangle,
} from 'lucide-react';
import type { AppModule } from './types';

/**
 * App Registry - Ù‚Ø§Ø¦Ù…Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©
 */
export const APP_MODULES: AppModule[] = [
  {
    id: 'awareness',
    name: 'Awareness',
    nameAr: 'Ø§Ù„ØªÙˆØ¹ÙŠØ© Ø§Ù„Ø£Ù…Ù†ÙŠØ©',
    description: 'Security Awareness Campaigns & Training',
    icon: Target,
    route: '/app/awareness',
    requiredPermission: 'app.awareness.access',
    color: 'hsl(var(--primary))',
    status: 'active',
    features: [
      {
        id: 'campaigns',
        name: 'Campaigns',
        nameAr: 'Ø§Ù„Ø­Ù…Ù„Ø§Øª',
        route: '/app/awareness/campaigns',
        icon: Megaphone,
        requiredPermission: 'awareness.campaign.view',
        showInSidebar: true,
        order: 1,
      },
      {
        id: 'participants',
        name: 'Participants',
        nameAr: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†',
        route: '/app/awareness/participants',
        icon: Users,
        requiredPermission: 'awareness.participant.view',
        showInSidebar: true,
        order: 2,
      },
      {
        id: 'reports',
        name: 'Reports',
        nameAr: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
        route: '/app/awareness/reports',
        icon: BarChart3,
        requiredPermission: 'awareness.report.view',
        showInSidebar: true,
        order: 3,
      },
      {
        id: 'content',
        name: 'Content Hub',
        nameAr: 'Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰',
        route: '/app/awareness/content',
        icon: FileText,
        requiredPermission: 'content.item.view',
        showInSidebar: true,
        order: 4,
      },
      {
        id: 'settings',
        name: 'Settings',
        nameAr: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
        route: '/app/awareness/settings',
        icon: Settings,
        requiredPermission: 'awareness.settings.edit',
        showInSidebar: true,
        order: 10,
      },
    ],
    metadata: {
      version: '2.0',
      lastUpdated: '2025-11-14',
      owner: 'Awareness Team',
    },
  },

  {
    id: 'lms',
    name: 'LMS',
    nameAr: 'Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¯Ø±ÙŠØ¨',
    description: 'Learning Management System for Training',
    icon: GraduationCap,
    route: '/app/lms',
    requiredPermission: 'app.lms.access',
    color: 'hsl(210, 100%, 50%)',
    status: 'coming_soon',
    features: [
      {
        id: 'courses',
        name: 'Courses',
        nameAr: 'Ø§Ù„Ø¯ÙˆØ±Ø§Øª',
        route: '/app/lms/courses',
        icon: BookOpen,
        requiredPermission: 'lms.course.view',
        showInSidebar: true,
        order: 1,
      },
      {
        id: 'my-learning',
        name: 'My Learning',
        nameAr: 'ØªØ¹Ù„Ù…ÙŠ',
        route: '/app/lms/my-learning',
        icon: UserCheck,
        requiredPermission: 'lms.course.enroll',
        showInSidebar: true,
        order: 2,
      },
      {
        id: 'assignments',
        name: 'Assignments',
        nameAr: 'Ø§Ù„Ù…Ù‡Ø§Ù…',
        route: '/app/lms/assignments',
        icon: FileCheck,
        requiredPermission: 'lms.assignment.view',
        showInSidebar: true,
        order: 3,
      },
      {
        id: 'certificates',
        name: 'Certificates',
        nameAr: 'Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª',
        route: '/app/lms/certificates',
        icon: Award,
        requiredPermission: 'lms.certificate.view',
        showInSidebar: true,
        order: 4,
      },
    ],
    dependencies: ['awareness'],
    metadata: {
      version: '1.0-beta',
      lastUpdated: '2025-11-14',
    },
  },

  {
    id: 'phishing',
    name: 'Phishing Simulator',
    nameAr: 'Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„ØªØµÙŠØ¯',
    description: 'Phishing Simulation & Testing',
    icon: Fish,
    route: '/app/phishing',
    requiredPermission: 'app.phishing.access',
    color: 'hsl(0, 80%, 50%)',
    status: 'coming_soon',
    features: [
      {
        id: 'campaigns',
        name: 'Campaigns',
        nameAr: 'Ø§Ù„Ø­Ù…Ù„Ø§Øª',
        route: '/app/phishing/campaigns',
        icon: Mail,
        requiredPermission: 'phishing.campaign.view',
        showInSidebar: true,
        order: 1,
      },
      {
        id: 'templates',
        name: 'Templates',
        nameAr: 'Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨',
        route: '/app/phishing/templates',
        icon: FileText,
        requiredPermission: 'phishing.template.view',
        showInSidebar: true,
        order: 2,
      },
      {
        id: 'results',
        name: 'Results',
        nameAr: 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬',
        route: '/app/phishing/results',
        icon: TrendingUp,
        requiredPermission: 'phishing.result.view',
        showInSidebar: true,
        order: 3,
      },
      {
        id: 'landing-pages',
        name: 'Landing Pages',
        nameAr: 'ØµÙØ­Ø§Øª Ø§Ù„Ù‡Ø¨ÙˆØ·',
        route: '/app/phishing/landing-pages',
        icon: MousePointer,
        requiredPermission: 'phishing.landing.manage',
        showInSidebar: true,
        order: 4,
      },
    ],
    dependencies: ['awareness'],
  },

  {
    id: 'grc',
    name: 'GRC',
    nameAr: 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„',
    description: 'Governance, Risk & Compliance',
    icon: Shield,
    route: '/app/grc',
    requiredPermission: 'app.grc.access',
    color: 'hsl(140, 60%, 45%)',
    status: 'beta',
    features: [
      {
        id: 'frameworks',
        name: 'Frameworks',
        nameAr: 'Ø§Ù„Ø£Ø·Ø± Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©',
        route: '/app/grc/frameworks',
        icon: Scale,
        requiredPermission: 'grc.framework.view',
        showInSidebar: true,
        order: 1,
      },
      {
        id: 'risks',
        name: 'Risks',
        nameAr: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
        route: '/app/grc/risks',
        icon: AlertTriangle,
        requiredPermission: 'grc.risk.view',
        showInSidebar: true,
        order: 2,
      },
      {
        id: 'controls',
        name: 'Controls',
        nameAr: 'Ø§Ù„Ø¶ÙˆØ§Ø¨Ø·',
        route: '/app/grc/controls',
        icon: FileCheck,
        requiredPermission: 'grc.control.view',
        showInSidebar: true,
        order: 3,
      },
      {
        id: 'compliance',
        name: 'Compliance',
        nameAr: 'Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„',
        route: '/app/grc/compliance',
        icon: Shield,
        requiredPermission: 'grc.compliance.view',
        showInSidebar: true,
        order: 4,
      },
    ],
  },
];

/**
 * Helper: Get app by ID
 */
export function getAppById(id: string): AppModule | undefined {
  return APP_MODULES.find(app => app.id === id);
}

/**
 * Helper: Get active apps only
 */
export function getActiveApps(): AppModule[] {
  return APP_MODULES.filter(app => 
    app.status === 'active' || app.status === 'beta'
  );
}

/**
 * Helper: Get app by route
 */
export function getAppByRoute(pathname: string): AppModule | undefined {
  return APP_MODULES.find(app => pathname.startsWith(app.route));
}
```

**Verification:**
- [ ] Types ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…ÙÙ‡ÙˆÙ…Ø©
- [ ] Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ø¹Ø±Ù‘ÙØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
- [ ] Ø§Ù„Ù€ icons Ùˆ colors Ù…Ù†Ø§Ø³Ø¨Ø©
- [ ] Helper functions ØªØ¹Ù…Ù„

#### Step 1.2.3: Ø¥Ù†Ø´Ø§Ø¡ useAppModules Hook (30 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/hooks/useAppModules.ts

import { useMemo } from 'react';
import { APP_MODULES, getActiveApps } from '@/core/config/appRegistry';
import { usePermissions } from '@/core/rbac';
import type { AppModule } from '@/core/config/types';

/**
 * Hook: Get available app modules for current user
 * 
 * Returns only apps that:
 * 1. Are active or beta
 * 2. User has permission to access
 * 
 * @example
 * ```tsx
 * const apps = useAppModules();
 * // apps = [{ id: 'awareness', name: 'Awareness', ... }]
 * ```
 */
export function useAppModules(): AppModule[] {
  const { hasPermission } = usePermissions();
  
  return useMemo(() => {
    const activeApps = getActiveApps();
    
    return activeApps.filter(app => {
      return hasPermission(app.requiredPermission);
    });
  }, [hasPermission]);
}

/**
 * Hook: Get specific app module
 */
export function useAppModule(appId: string): AppModule | undefined {
  const apps = useAppModules();
  return apps.find(app => app.id === appId);
}

/**
 * Hook: Check if user has access to app
 */
export function useHasAppAccess(appId: string): boolean {
  const { hasPermission } = usePermissions();
  const app = APP_MODULES.find(a => a.id === appId);
  
  if (!app) return false;
  
  return hasPermission(app.requiredPermission);
}
```

**Verification:**
- [ ] Hook returns correct apps
- [ ] Permissions filtering works
- [ ] useMemo optimization works

#### Step 1.2.4: Ø¥Ù†Ø´Ø§Ø¡ useAppFeatures Hook (30 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/hooks/useAppFeatures.ts

import { useMemo } from 'react';
import { useLocation } from 'react-router-dom';
import { getAppByRoute, APP_MODULES } from '@/core/config/appRegistry';
import { usePermissions } from '@/core/rbac';
import type { AppFeature } from '@/core/config/types';

/**
 * Hook: Get features for current app
 * 
 * Automatically detects current app from route
 * Returns only features user has permission for
 * 
 * @example
 * ```tsx
 * // On /app/awareness/campaigns page
 * const features = useAppFeatures();
 * // features = [
 * //   { id: 'campaigns', name: 'Campaigns', ... },
 * //   { id: 'participants', name: 'Participants', ... }
 * // ]
 * ```
 */
export function useAppFeatures(): AppFeature[] {
  const location = useLocation();
  const { hasPermission } = usePermissions();
  
  return useMemo(() => {
    const currentApp = getAppByRoute(location.pathname);
    
    if (!currentApp) return [];
    
    return currentApp.features
      .filter(feature => hasPermission(feature.requiredPermission))
      .filter(feature => feature.showInSidebar !== false)
      .sort((a, b) => (a.order || 999) - (b.order || 999));
  }, [location.pathname, hasPermission]);
}

/**
 * Hook: Get features for specific app
 */
export function useAppFeaturesById(appId: string): AppFeature[] {
  const { hasPermission } = usePermissions();
  const app = APP_MODULES.find(a => a.id === appId);
  
  return useMemo(() => {
    if (!app) return [];
    
    return app.features
      .filter(feature => hasPermission(feature.requiredPermission))
      .filter(feature => feature.showInSidebar !== false)
      .sort((a, b) => (a.order || 999) - (b.order || 999));
  }, [app, hasPermission]);
}

/**
 * Hook: Get current app from route
 */
export function useCurrentApp() {
  const location = useLocation();
  return useMemo(() => {
    return getAppByRoute(location.pathname);
  }, [location.pathname]);
}
```

**Verification:**
- [ ] Hook detects current app correctly
- [ ] Features filtered by permissions
- [ ] Features sorted by order

#### Step 1.2.5: Create Barrel Exports (15 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/config/index.ts
export * from './types';
export * from './appRegistry';

// src/core/hooks/index.ts
export * from './useAppModules';
export * from './useAppFeatures';
export * from './usePermissions';

// src/core/index.ts
export * from './config';
export * from './hooks';
export * from './rbac';
export * from './services';
export * from './components';
```

### Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ù‚Ù‚ (Checkpoints)

#### âœ… Checkpoint 1.2.A: Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Types
```typescript
// Test in console
import type { AppModule } from '@/core/config/types';
// Expected: No errors
```

#### âœ… Checkpoint 1.2.B: Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Registry
```typescript
// Test in a component
import { APP_MODULES, getActiveApps } from '@/core/config/appRegistry';

console.log('All apps:', APP_MODULES);
console.log('Active apps:', getActiveApps());

// Expected: 
// - 4 apps total
// - Awareness = active
// - LMS = coming_soon
// - Phishing = coming_soon
// - GRC = beta
```

#### âœ… Checkpoint 1.2.C: Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Hooks
```typescript
// Test in a component
import { useAppModules, useAppFeatures } from '@/core/hooks';

function TestComponent() {
  const apps = useAppModules();
  const features = useAppFeatures();
  
  console.log('Available apps:', apps);
  console.log('Current app features:', features);
  
  // Expected: Arrays with correct data based on permissions
}
```

### Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù‚Ø¨ÙˆÙ„

- [ ] âœ… appRegistry.ts Ù…ÙƒØªÙ…Ù„ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
- [ ] âœ… useAppModules() ÙŠØ¹ÙŠØ¯ ØªØ·Ø¨ÙŠÙ‚Ø§Øª ØµØ­ÙŠØ­Ø©
- [ ] âœ… useAppFeatures() ÙŠØ¹ÙŠØ¯ Ù…ÙŠØ²Ø§Øª ØµØ­ÙŠØ­Ø©
- [ ] âœ… Permissions filtering ÙŠØ¹Ù…Ù„
- [ ] âœ… Icons Ùˆ Colors ØµØ­ÙŠØ­Ø©
- [ ] âœ… Helper functions ØªØ¹Ù…Ù„
- [ ] âœ… TypeScript types ØµØ­ÙŠØ­Ø©
- [ ] âœ… Ù„Ø§ ÙŠÙˆØ¬Ø¯ performance issues

### Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±: 3 Ø³Ø§Ø¹Ø§Øª
- Ø¥Ù†Ø´Ø§Ø¡ Types: 15 Ø¯Ù‚ÙŠÙ‚Ø©
- Ø¥Ù†Ø´Ø§Ø¡ Registry: 45 Ø¯Ù‚ÙŠÙ‚Ø©
- useAppModules Hook: 30 Ø¯Ù‚ÙŠÙ‚Ø©
- useAppFeatures Hook: 30 Ø¯Ù‚ÙŠÙ‚Ø©
- Barrel Exports: 15 Ø¯Ù‚ÙŠÙ‚Ø©
- Testing & Verification: 45 Ø¯Ù‚ÙŠÙ‚Ø©
- **Total:** 180 Ø¯Ù‚ÙŠÙ‚Ø© = 3 Ø³Ø§Ø¹Ø§Øª

---

## ğŸ“¦ Part 1.3: Enhanced Permission System (6 Ø³Ø§Ø¹Ø§Øª)

### Ø§Ù„Ù‡Ø¯Ù
> ØªØ­ÙˆÙŠÙ„ Ù†Ø¸Ø§Ù… RBAC Ù…Ù† simple roles Ø¥Ù„Ù‰ resource-based permissions

### Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
```typescript
// Current: Simple roles
- admin (can do everything)
- user (limited access)
- viewer (read-only)

// Problem: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¯Ù‚ÙŠÙ‚ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
// Example: ÙƒÙŠÙ ØªØ¹Ø·ÙŠ Ù…Ø³ØªØ®Ø¯Ù… ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ campaigns Ø¨Ø¯ÙˆÙ† Ø£Ù† ÙŠÙƒÙˆÙ† adminØŸ
```

### Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù
```typescript
// New: Resource-based permissions
- awareness.campaign.create
- awareness.campaign.view
- awareness.campaign.edit
- awareness.campaign.delete
- lms.course.enroll
- phishing.campaign.launch
// ... etc

// Each role gets specific permissions
// admin: all permissions
// manager: manage permissions only
// user: view + enroll permissions
// viewer: view only
```

### Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°

#### Step 1.3.1: Database Migration (45 Ø¯Ù‚ÙŠÙ‚Ø©)

**Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:** Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª

```sql
-- Create role_permissions table
CREATE TABLE IF NOT EXISTS public.role_permissions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id UUID REFERENCES public.tenants(id) ON DELETE CASCADE,
  
  role_code TEXT NOT NULL,
  
  permission_code TEXT NOT NULL,
  
  description TEXT,
  created_at TIMESTAMPTZ DEFAULT now(),
  created_by UUID REFERENCES auth.users(id),
  updated_at TIMESTAMPTZ DEFAULT now(),
  
  CONSTRAINT unique_permission_per_role_tenant 
    UNIQUE(tenant_id, role_code, permission_code),
    
  CONSTRAINT valid_role_code 
    CHECK (role_code IN ('admin', 'manager', 'user', 'viewer', 'custom')),
    
  CONSTRAINT valid_permission_format
    CHECK (permission_code ~ '^[a-z_]+\.[a-z_]+\.[a-z_]+$')
);

-- Indexes for performance
CREATE INDEX idx_role_permissions_tenant ON public.role_permissions(tenant_id);
CREATE INDEX idx_role_permissions_role ON public.role_permissions(role_code);
CREATE INDEX idx_role_permissions_permission ON public.role_permissions(permission_code);
CREATE INDEX idx_role_permissions_lookup ON public.role_permissions(tenant_id, role_code);

-- Enable RLS
ALTER TABLE public.role_permissions ENABLE ROW LEVEL SECURITY;

-- RLS Policies
CREATE POLICY "Users can view permissions in their tenant"
  ON public.role_permissions FOR SELECT
  USING (tenant_id = get_user_tenant_id(auth.uid()));

CREATE POLICY "Admins can manage permissions"
  ON public.role_permissions FOR ALL
  USING (
    tenant_id = get_user_tenant_id(auth.uid()) 
    AND has_role(auth.uid(), 'admin')
  )
  WITH CHECK (
    tenant_id = get_user_tenant_id(auth.uid()) 
    AND has_role(auth.uid(), 'admin')
  );

-- Trigger for updated_at
CREATE TRIGGER update_role_permissions_updated_at
  BEFORE UPDATE ON public.role_permissions
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();

-- Seed Default Permissions
DO $$
DECLARE
  _tenant_id UUID;
BEGIN
  FOR _tenant_id IN SELECT id FROM public.tenants LOOP
    
    INSERT INTO public.role_permissions (tenant_id, role_code, permission_code, description)
    VALUES
      (_tenant_id, 'admin', 'app.awareness.access', 'Access Awareness app'),
      (_tenant_id, 'admin', 'app.lms.access', 'Access LMS app'),
      (_tenant_id, 'admin', 'app.phishing.access', 'Access Phishing app'),
      (_tenant_id, 'admin', 'app.grc.access', 'Access GRC app'),
      
      (_tenant_id, 'admin', 'awareness.campaign.view', 'View campaigns'),
      (_tenant_id, 'admin', 'awareness.campaign.create', 'Create campaigns'),
      (_tenant_id, 'admin', 'awareness.campaign.edit', 'Edit campaigns'),
      (_tenant_id, 'admin', 'awareness.campaign.delete', 'Delete campaigns'),
      (_tenant_id, 'admin', 'awareness.campaign.launch', 'Launch campaigns'),
      (_tenant_id, 'admin', 'awareness.campaign.archive', 'Archive campaigns'),
      
      (_tenant_id, 'admin', 'awareness.participant.view', 'View participants'),
      (_tenant_id, 'admin', 'awareness.participant.create', 'Add participants'),
      (_tenant_id, 'admin', 'awareness.participant.edit', 'Edit participants'),
      (_tenant_id, 'admin', 'awareness.participant.delete', 'Remove participants'),
      (_tenant_id, 'admin', 'awareness.participant.export', 'Export participant data'),
      
      (_tenant_id, 'admin', 'awareness.report.view', 'View reports'),
      (_tenant_id, 'admin', 'awareness.report.generate', 'Generate reports'),
      (_tenant_id, 'admin', 'awareness.report.export', 'Export reports'),
      
      (_tenant_id, 'admin', 'content.item.view', 'View content'),
      (_tenant_id, 'admin', 'content.item.create', 'Create content'),
      (_tenant_id, 'admin', 'content.item.edit', 'Edit content'),
      (_tenant_id, 'admin', 'content.item.delete', 'Delete content'),
      (_tenant_id, 'admin', 'content.item.publish', 'Publish content'),
      (_tenant_id, 'admin', 'content.quiz.create', 'Create quizzes'),
      (_tenant_id, 'admin', 'content.quiz.edit', 'Edit quizzes'),
      (_tenant_id, 'admin', 'content.evidence.export', 'Export evidence packs'),
      
      (_tenant_id, 'admin', 'lms.course.view', 'View courses'),
      (_tenant_id, 'admin', 'lms.course.create', 'Create courses'),
      (_tenant_id, 'admin', 'lms.course.edit', 'Edit courses'),
      (_tenant_id, 'admin', 'lms.course.delete', 'Delete courses'),
      (_tenant_id, 'admin', 'lms.course.enroll', 'Enroll in courses'),
      (_tenant_id, 'admin', 'lms.assignment.view', 'View assignments'),
      (_tenant_id, 'admin', 'lms.assignment.submit', 'Submit assignments'),
      (_tenant_id, 'admin', 'lms.assignment.grade', 'Grade assignments'),
      (_tenant_id, 'admin', 'lms.certificate.view', 'View certificates'),
      (_tenant_id, 'admin', 'lms.certificate.issue', 'Issue certificates'),
      
      (_tenant_id, 'admin', 'phishing.campaign.view', 'View phishing campaigns'),
      (_tenant_id, 'admin', 'phishing.campaign.create', 'Create phishing campaigns'),
      (_tenant_id, 'admin', 'phishing.campaign.launch', 'Launch phishing campaigns'),
      (_tenant_id, 'admin', 'phishing.template.view', 'View phishing templates'),
      (_tenant_id, 'admin', 'phishing.template.create', 'Create phishing templates'),
      (_tenant_id, 'admin', 'phishing.result.view', 'View phishing results'),
      (_tenant_id, 'admin', 'phishing.landing.manage', 'Manage landing pages'),
      
      (_tenant_id, 'admin', 'grc.framework.view', 'View frameworks'),
      (_tenant_id, 'admin', 'grc.framework.edit', 'Edit frameworks'),
      (_tenant_id, 'admin', 'grc.risk.view', 'View risks'),
      (_tenant_id, 'admin', 'grc.risk.create', 'Create risks'),
      (_tenant_id, 'admin', 'grc.risk.edit', 'Edit risks'),
      (_tenant_id, 'admin', 'grc.control.view', 'View controls'),
      (_tenant_id, 'admin', 'grc.control.test', 'Test controls'),
      (_tenant_id, 'admin', 'grc.compliance.view', 'View compliance status'),
      
      (_tenant_id, 'admin', 'system.settings.view', 'View system settings'),
      (_tenant_id, 'admin', 'system.settings.edit', 'Edit system settings'),
      (_tenant_id, 'admin', 'system.users.view', 'View users'),
      (_tenant_id, 'admin', 'system.users.manage', 'Manage users'),
      (_tenant_id, 'admin', 'system.audit.view', 'View audit logs'),
      (_tenant_id, 'admin', 'system.integrations.manage', 'Manage integrations')
    ON CONFLICT (tenant_id, role_code, permission_code) DO NOTHING;
    
    INSERT INTO public.role_permissions (tenant_id, role_code, permission_code)
    VALUES
      (_tenant_id, 'manager', 'app.awareness.access'),
      (_tenant_id, 'manager', 'app.lms.access'),
      
      (_tenant_id, 'manager', 'awareness.campaign.view'),
      (_tenant_id, 'manager', 'awareness.campaign.create'),
      (_tenant_id, 'manager', 'awareness.campaign.edit'),
      (_tenant_id, 'manager', 'awareness.campaign.launch'),
      (_tenant_id, 'manager', 'awareness.participant.view'),
      (_tenant_id, 'manager', 'awareness.participant.create'),
      (_tenant_id, 'manager', 'awareness.participant.edit'),
      (_tenant_id, 'manager', 'awareness.report.view'),
      (_tenant_id, 'manager', 'awareness.report.generate'),
      
      (_tenant_id, 'manager', 'content.item.view'),
      (_tenant_id, 'manager', 'content.item.create'),
      (_tenant_id, 'manager', 'content.item.edit'),
      (_tenant_id, 'manager', 'content.quiz.create'),
      (_tenant_id, 'manager', 'content.quiz.edit'),
      
      (_tenant_id, 'manager', 'lms.course.view'),
      (_tenant_id, 'manager', 'lms.course.enroll'),
      (_tenant_id, 'manager', 'lms.assignment.view'),
      (_tenant_id, 'manager', 'lms.assignment.grade'),
      (_tenant_id, 'manager', 'lms.certificate.view')
    ON CONFLICT (tenant_id, role_code, permission_code) DO NOTHING;
    
    INSERT INTO public.role_permissions (tenant_id, role_code, permission_code)
    VALUES
      (_tenant_id, 'user', 'app.awareness.access'),
      (_tenant_id, 'user', 'app.lms.access'),
      
      (_tenant_id, 'user', 'awareness.campaign.view'),
      (_tenant_id, 'user', 'awareness.participant.view'),
      (_tenant_id, 'user', 'awareness.report.view'),
      
      (_tenant_id, 'user', 'content.item.view'),
      
      (_tenant_id, 'user', 'lms.course.view'),
      (_tenant_id, 'user', 'lms.course.enroll'),
      (_tenant_id, 'user', 'lms.assignment.view'),
      (_tenant_id, 'user', 'lms.assignment.submit'),
      (_tenant_id, 'user', 'lms.certificate.view')
    ON CONFLICT (tenant_id, role_code, permission_code) DO NOTHING;
    
    INSERT INTO public.role_permissions (tenant_id, role_code, permission_code)
    VALUES
      (_tenant_id, 'viewer', 'app.awareness.access'),
      (_tenant_id, 'viewer', 'app.lms.access'),
      
      (_tenant_id, 'viewer', 'awareness.campaign.view'),
      (_tenant_id, 'viewer', 'awareness.participant.view'),
      (_tenant_id, 'viewer', 'awareness.report.view'),
      
      (_tenant_id, 'viewer', 'content.item.view'),
      
      (_tenant_id, 'viewer', 'lms.course.view'),
      (_tenant_id, 'viewer', 'lms.certificate.view')
    ON CONFLICT (tenant_id, role_code, permission_code) DO NOTHING;
    
  END LOOP;
END $$;

-- Helper Function: Get User Permissions
CREATE OR REPLACE FUNCTION public.get_user_permissions(_user_id UUID)
RETURNS TEXT[]
LANGUAGE SQL
STABLE
SECURITY DEFINER
SET search_path = public
AS $$
  SELECT ARRAY_AGG(DISTINCT rp.permission_code)
  FROM public.user_roles ur
  JOIN public.role_permissions rp 
    ON ur.role = rp.role_code 
    AND ur.tenant_id = rp.tenant_id
  WHERE ur.user_id = _user_id
    AND ur.tenant_id = get_user_tenant_id(_user_id);
$$;

-- Helper Function: Check Permission
CREATE OR REPLACE FUNCTION public.has_permission(
  _user_id UUID,
  _permission TEXT
)
RETURNS BOOLEAN
LANGUAGE SQL
STABLE
SECURITY DEFINER
SET search_path = public
AS $$
  SELECT EXISTS (
    SELECT 1
    FROM public.user_roles ur
    JOIN public.role_permissions rp 
      ON ur.role = rp.role_code 
      AND ur.tenant_id = rp.tenant_id
    WHERE ur.user_id = _user_id
      AND rp.permission_code = _permission
      AND ur.tenant_id = get_user_tenant_id(_user_id)
  );
$$;

-- Test the functions
DO $$
DECLARE
  _test_user UUID;
  _test_permissions TEXT[];
BEGIN
  SELECT id INTO _test_user FROM auth.users LIMIT 1;
  
  IF _test_user IS NOT NULL THEN
    SELECT get_user_permissions(_test_user) INTO _test_permissions;
    RAISE NOTICE 'Test user permissions: %', _test_permissions;
    
    RAISE NOTICE 'Has awareness.campaign.view: %', 
      has_permission(_test_user, 'awareness.campaign.view');
  END IF;
END $$;
```

**Verification Checklist:**
- [ ] âœ… Table created successfully
- [ ] âœ… Indexes created
- [ ] âœ… RLS policies active
- [ ] âœ… Default permissions seeded
- [ ] âœ… Helper functions work
- [ ] âœ… Test queries return expected results

**Testing Commands:**
```sql
-- Check table structure
\d public.role_permissions

-- Count permissions per role
SELECT role_code, COUNT(*) as permission_count
FROM public.role_permissions
GROUP BY role_code;

-- Test permission lookup
SELECT * FROM public.role_permissions
WHERE role_code = 'admin'
  AND permission_code LIKE 'awareness%'
ORDER BY permission_code;
```

#### Step 1.3.2: Create usePermissions Hook (90 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/rbac/usePermissions.ts

import { useQuery } from '@tanstack/react-query';
import { useCallback, useMemo } from 'react';
import { supabase } from '@/integrations/supabase/client';
import { useAppContext } from '@/lib/app-context/AppContextProvider';

interface Permission {
  permission_code: string;
  description?: string;
}

export function usePermissions() {
  const { tenantId, userRoles, userId } = useAppContext();
  
  const { 
    data: permissions = [], 
    isLoading,
    error,
    refetch 
  } = useQuery({
    queryKey: ['permissions', tenantId, userRoles],
    queryFn: async () => {
      if (!tenantId || !userRoles || userRoles.length === 0) {
        return [];
      }
      
      const { data, error } = await supabase
        .from('role_permissions')
        .select('permission_code, description')
        .eq('tenant_id', tenantId)
        .in('role_code', userRoles);
      
      if (error) {
        console.error('Error fetching permissions:', error);
        throw error;
      }
      
      return data || [];
    },
    enabled: !!tenantId && !!userRoles && userRoles.length > 0,
    staleTime: 5 * 60 * 1000,
    gcTime: 10 * 60 * 1000,
  });
  
  const permissionCodes = useMemo(() => {
    return permissions.map(p => p.permission_code);
  }, [permissions]);
  
  const hasPermission = useCallback((permission: string): boolean => {
    if (userRoles.includes('admin')) {
      return true;
    }
    
    return permissionCodes.includes(permission);
  }, [permissionCodes, userRoles]);
  
  const hasAnyPermission = useCallback((perms: string[]): boolean => {
    if (userRoles.includes('admin')) {
      return true;
    }
    
    return perms.some(p => permissionCodes.includes(p));
  }, [permissionCodes, userRoles]);
  
  const hasAllPermissions = useCallback((perms: string[]): boolean => {
    if (userRoles.includes('admin')) {
      return true;
    }
    
    return perms.every(p => permissionCodes.includes(p));
  }, [permissionCodes, userRoles]);
  
  const getResourcePermissions = useCallback((resource: string): string[] => {
    if (userRoles.includes('admin')) {
      return ['view', 'create', 'edit', 'delete', 'manage'];
    }
    
    return permissionCodes
      .filter(p => p.startsWith(resource + '.'))
      .map(p => p.split('.').pop() || '');
  }, [permissionCodes, userRoles]);
  
  const canDo = useCallback((action: string, resource: string): boolean => {
    return hasPermission(`${resource}.${action}`);
  }, [hasPermission]);
  
  return {
    permissions: permissionCodes,
    isLoading,
    error,
    
    hasPermission,
    hasAnyPermission,
    hasAllPermissions,
    getResourcePermissions,
    canDo,
    
    refetch,
  };
}

export function useHasPermission(permission: string): boolean {
  const { hasPermission } = usePermissions();
  return hasPermission(permission);
}

export function useResourcePermissions(resource: string): string[] {
  const { getResourcePermissions } = usePermissions();
  return getResourcePermissions(resource);
}
```

**Verification:**
- [ ] Hook fetches permissions correctly
- [ ] Cache works (5 min staleTime)
- [ ] hasPermission() works
- [ ] hasAnyPermission() works
- [ ] hasAllPermissions() works
- [ ] Admin bypass works
- [ ] Performance is good

#### Step 1.3.3: Create PermissionGuard Component (60 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/components/PermissionGuard.tsx

import { ReactNode } from 'react';
import { usePermissions } from '@/core/rbac/usePermissions';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { ShieldX } from 'lucide-react';

interface PermissionGuardProps {
  permission: string | string[];
  requireAll?: boolean;
  fallback?: ReactNode;
  showDenied?: boolean;
  children: ReactNode;
}

export function PermissionGuard({
  permission,
  requireAll = false,
  fallback,
  showDenied = false,
  children,
}: PermissionGuardProps) {
  const { hasPermission, hasAnyPermission, hasAllPermissions, isLoading } = usePermissions();
  
  if (isLoading) {
    return fallback || null;
  }
  
  const hasAccess = Array.isArray(permission)
    ? (requireAll ? hasAllPermissions(permission) : hasAnyPermission(permission))
    : hasPermission(permission);
  
  if (hasAccess) {
    return <>{children}</>;
  }
  
  if (fallback) {
    return <>{fallback}</>;
  }
  
  if (showDenied) {
    return (
      <Alert variant="destructive">
        <ShieldX className="h-4 w-4" />
        <AlertTitle>Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„ÙˆØµÙˆÙ„</AlertTitle>
        <AlertDescription>
          Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø©
        </AlertDescription>
      </Alert>
    );
  }
  
  return null;
}

export const RequirePermission = PermissionGuard;
```

**Verification:**
- [ ] Component renders children when permission granted
- [ ] Component hides children when permission denied
- [ ] fallback prop works
- [ ] showDenied prop works
- [ ] Loading state handled
- [ ] Array permissions work (ANY/ALL)

#### Step 1.3.4: Update Existing RBAC (45 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/rbac/index.tsx

import { useCallback } from 'react';
import { usePermissions } from './usePermissions';

export function useCan() {
  const { canDo, hasPermission } = usePermissions();
  
  return useCallback((action: string, resource?: string) => {
    if (resource) {
      return canDo(action, resource);
    } else {
      return hasPermission(action);
    }
  }, [canDo, hasPermission]);
}

export * from './usePermissions';
export * from './RoleGuard';
export { PermissionGuard, RequirePermission } from '@/core/components/PermissionGuard';
```

**Update RoleGuard to support permissions:**
```typescript
// src/core/rbac/RoleGuard.tsx

import { ReactNode } from 'react';
import { usePermissions } from './usePermissions';
import { useAppContext } from '@/lib/app-context/AppContextProvider';

interface RoleGuardProps {
  roles?: string[];
  permissions?: string | string[];
  fallback?: ReactNode;
  children: ReactNode;
}

export function RoleGuard({ 
  roles, 
  permissions, 
  fallback, 
  children 
}: RoleGuardProps) {
  const { userRoles } = useAppContext();
  const { hasPermission, hasAnyPermission } = usePermissions();
  
  if (roles && roles.length > 0) {
    const hasRole = roles.some(role => userRoles.includes(role));
    if (!hasRole) {
      return fallback || null;
    }
  }
  
  if (permissions) {
    const hasAccess = Array.isArray(permissions)
      ? hasAnyPermission(permissions)
      : hasPermission(permissions);
    
    if (!hasAccess) {
      return fallback || null;
    }
  }
  
  return <>{children}</>;
}
```

**Verification:**
- [ ] useCan() backward compatible
- [ ] useCan() supports new format
- [ ] RoleGuard supports permissions
- [ ] RoleGuard backward compatible
- [ ] All existing code still works

#### Step 1.3.5: Integration Tests (60 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/rbac/__tests__/permissions.test.ts

import { describe, it, expect, beforeEach } from 'vitest';
import { renderHook, waitFor } from '@testing-library/react';
import { usePermissions } from '../usePermissions';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';

describe('usePermissions', () => {
  let queryClient: QueryClient;
  
  beforeEach(() => {
    queryClient = new QueryClient({
      defaultOptions: {
        queries: { retry: false },
      },
    });
  });
  
  it('should fetch permissions for user roles', async () => {
    const wrapper = ({ children }) => (
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    );
    
    const { result } = renderHook(() => usePermissions(), { wrapper });
    
    await waitFor(() => {
      expect(result.current.isLoading).toBe(false);
    });
    
    expect(result.current.permissions).toBeInstanceOf(Array);
  });
  
  it('should check single permission', async () => {
    const wrapper = ({ children }) => (
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    );
    
    const { result } = renderHook(() => usePermissions(), { wrapper });
    
    await waitFor(() => {
      expect(result.current.isLoading).toBe(false);
    });
    
    const hasPermission = result.current.hasPermission('awareness.campaign.create');
    expect(typeof hasPermission).toBe('boolean');
  });
  
  it('should check multiple permissions (ANY)', async () => {
    const wrapper = ({ children }) => (
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    );
    
    const { result } = renderHook(() => usePermissions(), { wrapper });
    
    await waitFor(() => {
      expect(result.current.isLoading).toBe(false);
    });
    
    const hasAny = result.current.hasAnyPermission([
      'awareness.campaign.create',
      'awareness.campaign.view',
    ]);
    
    expect(typeof hasAny).toBe('boolean');
  });
  
  it('should check multiple permissions (ALL)', async () => {
    const wrapper = ({ children }) => (
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    );
    
    const { result } = renderHook(() => usePermissions(), { wrapper });
    
    await waitFor(() => {
      expect(result.current.isLoading).toBe(false);
    });
    
    const hasAll = result.current.hasAllPermissions([
      'awareness.campaign.view',
      'awareness.campaign.create',
    ]);
    
    expect(typeof hasAll).toBe('boolean');
  });
  
  it('should get resource permissions', async () => {
    const wrapper = ({ children }) => (
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    );
    
    const { result } = renderHook(() => usePermissions(), { wrapper });
    
    await waitFor(() => {
      expect(result.current.isLoading).toBe(false);
    });
    
    const resourcePerms = result.current.getResourcePermissions('awareness.campaign');
    expect(Array.isArray(resourcePerms)).toBe(true);
  });
});
```

**Run tests:**
```bash
npm run test src/core/rbac/__tests__/permissions.test.ts
```

### Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ù‚Ù‚ (Checkpoints)

#### âœ… Checkpoint 1.3.A: Ø¨Ø¹Ø¯ Migration
```sql
-- Verify table exists
SELECT COUNT(*) FROM public.role_permissions;

-- Verify admin has all permissions
SELECT COUNT(*) 
FROM public.role_permissions 
WHERE role_code = 'admin';

-- Verify functions work
SELECT has_permission(
  (SELECT id FROM auth.users LIMIT 1),
  'awareness.campaign.view'
);
```

#### âœ… Checkpoint 1.3.B: Ø¨Ø¹Ø¯ usePermissions Hook
```typescript
// Test in a component
import { usePermissions } from '@/core/rbac';

function TestComponent() {
  const { permissions, hasPermission } = usePermissions();
  
  console.log('User permissions:', permissions);
  console.log('Can create campaigns:', hasPermission('awareness.campaign.create'));
}
```

#### âœ… Checkpoint 1.3.C: Ø¨Ø¹Ø¯ PermissionGuard
```typescript
// Test in UI
<PermissionGuard permission="awareness.campaign.create">
  <Button>Create Campaign</Button>
</PermissionGuard>
```

#### âœ… Checkpoint 1.3.D: Final Integration Test
```typescript
// Test full flow
import { usePermissions } from '@/core/rbac';
import { PermissionGuard } from '@/core/components';

function CampaignPage() {
  const { hasPermission, getResourcePermissions } = usePermissions();
  const campaignPerms = getResourcePermissions('awareness.campaign');
  
  return (
    <div>
      <h1>Campaigns</h1>
      
      <PermissionGuard permission="awareness.campaign.view">
        <CampaignsList />
      </PermissionGuard>
      
      <PermissionGuard permission="awareness.campaign.create">
        <CreateCampaignButton />
      </PermissionGuard>
      
      <PermissionGuard 
        permission={['awareness.campaign.edit', 'awareness.campaign.delete']}
        requireAll
      >
        <AdminActions />
      </PermissionGuard>
    </div>
  );
}
```

### Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

1. **Backup Ù‚Ø¨Ù„ Migration:**
```bash
pg_dump -t role_permissions > backup_role_permissions.sql
```

2. **Test Migration ÙÙŠ Development Ø£ÙˆÙ„Ø§Ù‹:**
```sql
BEGIN;
  -- Run migration for one tenant
  -- Test queries
  -- If OK: COMMIT
  -- If Error: ROLLBACK
ROLLBACK;
```

3. **Verify Permissions Coverage:**
```sql
SELECT 
  SUBSTRING(permission_code FROM 1 FOR POSITION('.' IN permission_code) - 1) as app,
  COUNT(*) as perm_count
FROM public.role_permissions
WHERE role_code = 'admin'
GROUP BY app
ORDER BY app;
```

4. **Monitor Performance:**
```sql
EXPLAIN ANALYZE
SELECT * FROM public.role_permissions
WHERE tenant_id = 'xxx'
  AND role_code = 'user';
```

### Rollback Plan

```sql
-- Option 1: Drop table
DROP TABLE IF EXISTS public.role_permissions CASCADE;

-- Option 2: Restore from backup
psql < backup_role_permissions.sql
```

### Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù‚Ø¨ÙˆÙ„

- [ ] âœ… role_permissions table Ù…ÙˆØ¬ÙˆØ¯
- [ ] âœ… Default permissions seeded Ù„ÙƒÙ„ tenant
- [ ] âœ… usePermissions() hook ÙŠØ¹Ù…Ù„
- [ ] âœ… PermissionGuard component ÙŠØ¹Ù…Ù„
- [ ] âœ… useCan() backward compatible
- [ ] âœ… RoleGuard enhanced
- [ ] âœ… Tests ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­
- [ ] âœ… Performance Ø¬ÙŠØ¯ (< 5ms per query)
- [ ] âœ… Ù„Ø§ ÙŠÙˆØ¬Ø¯ breaking changes
- [ ] âœ… Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„Ø§Øª

### Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±: 6 Ø³Ø§Ø¹Ø§Øª
- Database Migration: 45 Ø¯Ù‚ÙŠÙ‚Ø©
- usePermissions Hook: 90 Ø¯Ù‚ÙŠÙ‚Ø©
- PermissionGuard Component: 60 Ø¯Ù‚ÙŠÙ‚Ø©
- Update Existing RBAC: 45 Ø¯Ù‚ÙŠÙ‚Ø©
- Integration Tests: 60 Ø¯Ù‚ÙŠÙ‚Ø©
- Verification & Documentation: 60 Ø¯Ù‚ÙŠÙ‚Ø©
- **Total:** 360 Ø¯Ù‚ÙŠÙ‚Ø© = 6 Ø³Ø§Ø¹Ø§Øª

---

## ğŸ“¦ Part 1.4: Dynamic Sidebar (2 Ø³Ø§Ø¹Ø§Øª)

### Ø§Ù„Ù‡Ø¯Ù
> ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù…Ù† static hardcoded Ø¥Ù„Ù‰ dynamic ØªØªØºÙŠØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ App Registry + Permissions

### Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
```typescript
// Current: Hardcoded sidebar items
<nav>
  <Link to="/app/campaigns">Campaigns</Link>
  <Link to="/app/participants">Participants</Link>
  <Link to="/app/reports">Reports</Link>
</nav>

// Problems:
// 1. ØµØ¹Ø¨ Ø¥Ø¶Ø§ÙØ© ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
// 2. Ù„Ø§ ØªØªØºÙŠØ± Ø­Ø³Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
// 3. Ù„Ø§ ØªØ¯Ø¹Ù… multi-app structure
```

### Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù
```typescript
// New: Dynamic sidebar
// - ÙŠÙ‚Ø±Ø£ Ù…Ù† App Registry
// - ÙŠØªØºÙŠØ± Ø­Ø³Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
// - ÙŠØ¯Ø¹Ù… App Switcher
// - ÙŠØ¯Ø¹Ù… App-specific navigation
```

### Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°

#### Step 1.4.1: Create App Switcher Component (30 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/components/AppSwitcher.tsx

import { Link, useLocation } from 'react-router-dom';
import { useAppModules, useCurrentApp } from '@/core/hooks';
import { cn } from '@/lib/utils';
import { Badge } from '@/components/ui/badge';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';

export function AppSwitcher() {
  const availableApps = useAppModules();
  const currentApp = useCurrentApp();
  const location = useLocation();
  
  if (availableApps.length === 0) {
    return null;
  }
  
  return (
    <div className="app-switcher flex flex-col gap-2 p-3 border-b">
      <h3 className="text-xs font-semibold text-muted-foreground px-2">
        Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
      </h3>
      
      <TooltipProvider>
        <div className="flex flex-col gap-1">
          {availableApps.map(app => {
            const isActive = currentApp?.id === app.id;
            const Icon = app.icon;
            
            return (
              <Tooltip key={app.id}>
                <TooltipTrigger asChild>
                  <Link
                    to={app.route}
                    className={cn(
                      "flex items-center gap-3 px-3 py-2 rounded-md text-sm transition-colors",
                      "hover:bg-accent hover:text-accent-foreground",
                      isActive && "bg-primary text-primary-foreground hover:bg-primary/90"
                    )}
                    style={{
                      borderRight: isActive ? `3px solid ${app.color}` : undefined,
                    }}
                  >
                    <Icon className="h-4 w-4 flex-shrink-0" />
                    <span className="flex-1">{app.nameAr}</span>
                    
                    {app.status === 'beta' && (
                      <Badge variant="secondary" className="text-xs">
                        Beta
                      </Badge>
                    )}
                    
                    {app.status === 'coming_soon' && (
                      <Badge variant="outline" className="text-xs">
                        Ù‚Ø±ÙŠØ¨Ø§Ù‹
                      </Badge>
                    )}
                  </Link>
                </TooltipTrigger>
                
                <TooltipContent side="left">
                  <p>{app.description}</p>
                </TooltipContent>
              </Tooltip>
            );
          })}
        </div>
      </TooltipProvider>
    </div>
  );
}
```

#### Step 1.4.2: Create App Navigation Component (45 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/core/components/AppNavigation.tsx

import { Link, useLocation } from 'react-router-dom';
import { useAppFeatures, useCurrentApp } from '@/core/hooks';
import { cn } from '@/lib/utils';
import { Badge } from '@/components/ui/badge';

export function AppNavigation() {
  const currentApp = useCurrentApp();
  const features = useAppFeatures();
  const location = useLocation();
  
  if (!currentApp || features.length === 0) {
    return null;
  }
  
  return (
    <nav className="app-navigation flex flex-col gap-2 p-3">
      <div className="px-2 mb-2">
        <h2 className="text-lg font-bold">{currentApp.nameAr}</h2>
        <p className="text-xs text-muted-foreground">
          {currentApp.description}
        </p>
      </div>
      
      <div className="flex flex-col gap-1">
        {features.map(feature => {
          const isActive = location.pathname.startsWith(feature.route);
          const Icon = feature.icon;
          
          return (
            <Link
              key={feature.id}
              to={feature.route}
              className={cn(
                "flex items-center gap-3 px-3 py-2 rounded-md text-sm transition-colors",
                "hover:bg-accent hover:text-accent-foreground",
                isActive && "bg-accent text-accent-foreground font-medium"
              )}
            >
              <Icon className="h-4 w-4 flex-shrink-0" />
              <span className="flex-1">{feature.nameAr}</span>
              
              {isActive && (
                <div className="h-2 w-2 rounded-full bg-primary" />
              )}
            </Link>
          );
        })}
      </div>
    </nav>
  );
}
```

#### Step 1.4.3: Update Main Sidebar (45 Ø¯Ù‚ÙŠÙ‚Ø©)

```typescript
// src/layouts/AppSidebar.tsx

import { AppSwitcher } from '@/core/components/AppSwitcher';
import { AppNavigation } from '@/core/components/AppNavigation';
import { Separator } from '@/components/ui/separator';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Button } from '@/components/ui/button';
import { Settings, LogOut, User } from 'lucide-react';
import { Link } from 'react-router-dom';
import { useAppContext } from '@/lib/app-context/AppContextProvider';

export function AppSidebar() {
  const { profile } = useAppContext();
  
  return (
    <aside className="w-64 border-l bg-card flex flex-col h-screen">
      <div className="h-16 flex items-center justify-center border-b">
        <h1 className="text-xl font-bold">Romuz</h1>
      </div>
      
      <ScrollArea className="flex-1">
        <AppSwitcher />
        
        <Separator />
        
        <AppNavigation />
      </ScrollArea>
      
      <Separator />
      
      <div className="p-3 space-y-2">
        <Link to="/app/settings">
          <Button variant="ghost" className="w-full justify-start" size="sm">
            <Settings className="h-4 w-4 ml-2" />
            Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
          </Button>
        </Link>
        
        <Link to="/app/profile">
          <Button variant="ghost" className="w-full justify-start" size="sm">
            <User className="h-4 w-4 ml-2" />
            {profile?.full_name || 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ'}
          </Button>
        </Link>
        
        <Button 
          variant="ghost" 
          className="w-full justify-start text-destructive hover:text-destructive" 
          size="sm"
          onClick={() => {
            // Logout logic
          }}
        >
          <LogOut className="h-4 w-4 ml-2" />
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </Button>
      </div>
    </aside>
  );
}
```

**Replace old sidebar:**
```typescript
// src/layouts/AppLayout.tsx

import { AppSidebar } from './AppSidebar';

export function AppLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="flex h-screen">
      <AppSidebar />
      
      <main className="flex-1 overflow-auto">
        {children}
      </main>
    </div>
  );
}
```

### Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ù‚Ù‚ (Checkpoints)

#### âœ… Checkpoint 1.4.A: Ø¨Ø¹Ø¯ AppSwitcher
```typescript
// Test: App Switcher shows available apps
// 1. Login as admin
// Expected: See all 4 apps (Awareness, LMS, Phishing, GRC)

// 2. Login as user
// Expected: See only apps with user permissions

// 3. Click on different apps
// Expected: Navigate to app route
```

#### âœ… Checkpoint 1.4.B: Ø¨Ø¹Ø¯ AppNavigation
```typescript
// Test: App Navigation shows correct features
// 1. Navigate to /app/awareness/campaigns
// Expected: See Awareness app navigation (Campaigns, Participants, Reports, etc.)

// 2. Navigate to /app/lms/courses
// Expected: See LMS app navigation (Courses, My Learning, etc.)

// 3. Test permissions
// Expected: Only features with permission show up
```

#### âœ… Checkpoint 1.4.C: Final Integration
```typescript
// Test: Full sidebar flow
// 1. Login
// Expected: Sidebar shows available apps

// 2. Click app in App Switcher
// Expected: App Navigation updates to show that app's features

// 3. Click feature
// Expected: Navigate to feature page

// 4. Check active states
// Expected: Active app and feature highlighted
```

### Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù‚Ø¨ÙˆÙ„

- [ ] âœ… AppSwitcher shows only allowed apps
- [ ] âœ… AppNavigation shows only allowed features
- [ ] âœ… Active states work correctly
- [ ] âœ… Navigation works
- [ ] âœ… Icons and colors correct
- [ ] âœ… RTL support works
- [ ] âœ… Responsive design
- [ ] âœ… No hardcoded items
- [ ] âœ… Easy to add new apps (just update Registry)

### Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±: 2 Ø³Ø§Ø¹Ø§Øª
- AppSwitcher: 30 Ø¯Ù‚ÙŠÙ‚Ø©
- AppNavigation: 45 Ø¯Ù‚ÙŠÙ‚Ø©
- Update Main Sidebar: 45 Ø¯Ù‚ÙŠÙ‚Ø©
- **Total:** 120 Ø¯Ù‚ÙŠÙ‚Ø© = 2 Ø³Ø§Ø¹Ø§Øª

---

## ğŸ“¦ Part 1.5: Content Hub Full Implementation (9 Ø³Ø§Ø¹Ø§Øª)

### Ø§Ù„Ù‡Ø¯Ù
> Ø¥ÙƒÙ…Ø§Ù„ ØªÙ†ÙÙŠØ° M4 Content Hub (Ø­Ø§Ù„ÙŠØ§Ù‹ 25%)ØŒ Ø¨Ù…Ø§ ÙŠØ´Ù…Ù„:
> - 7 Ø¬Ø¯Ø§ÙˆÙ„ Ù…ÙÙ‚ÙˆØ¯Ø©
> - Integration layer ÙƒØ§Ù…Ù„
> - UI Components
> - Hooks

### Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
```
âœ… campaign_modules (Ù…ÙˆØ¬ÙˆØ¯)
âŒ contents (Ù…ÙÙ‚ÙˆØ¯)
âŒ content_assets (Ù…ÙÙ‚ÙˆØ¯)
âŒ quiz_templates (Ù…ÙÙ‚ÙˆØ¯)
âŒ quiz_template_questions (Ù…ÙÙ‚ÙˆØ¯)
âŒ micro_journeys (Ù…ÙÙ‚ÙˆØ¯)
âŒ evidence_packs (Ù…ÙÙ‚ÙˆØ¯)
âŒ content_audit_log (Ù…ÙÙ‚ÙˆØ¯)
```

### Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°

Ø³Ø£ÙƒÙ…Ù„ ØªÙØ§ØµÙŠÙ„ Part 1.5 ÙÙŠ Ø±Ø¯ Ù…Ù†ÙØµÙ„ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø·ÙˆÙ„...

---

## ğŸ¯ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1

| Part | Ø§Ù„ÙˆÙ‚Øª | Ø§Ù„Ø­Ø§Ù„Ø© | Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© |
|------|-------|--------|----------|
| 1.1 Code Restructuring | 4h | ğŸ“‹ Planned | ğŸ”´ P0 Critical |
| 1.2 App Registry | 3h | ğŸ“‹ Planned | ğŸ”´ P0 Critical |
| 1.3 Enhanced Permissions | 6h | ğŸ“‹ Planned | ğŸ”´ P0 Critical |
| 1.4 Dynamic Sidebar | 2h | ğŸ“‹ Planned | ğŸŸ¡ P1 High |
| 1.5 Content Hub | 9h | ğŸ“‹ Planned | ğŸŸ¡ P1 High |
| **Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹** | **24h** | â€” | â€” |

### Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1ØŒ Ø³ÙŠÙƒÙˆÙ† Ø§Ù„Ù†Ø¸Ø§Ù…:
- âœ… Ù…Ù†ØµØ© Ø­Ù‚ÙŠÙ‚ÙŠØ© (Platform) ÙˆÙ„ÙŠØ³ ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ø­Ø¯
- âœ… Ø¨Ù†ÙŠØ© ÙƒÙˆØ¯ Ù…Ù†Ø¸Ù…Ø© (core/modules/apps)
- âœ… Ù†Ø¸Ø§Ù… ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø±Ù† ÙˆÙ‚ÙˆÙŠ
- âœ… App Registry Ù…Ø±ÙƒØ²ÙŠ
- âœ… Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
- âœ… Content Hub ÙƒØ§Ù…Ù„ 100%
- âœ… Ø¬Ø§Ù‡Ø² Ù„Ø¥Ø¶Ø§ÙØ© ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹Ø§Øª

---

**Ø§Ù„ØªØ§Ù„ÙŠ:** Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£Ù† Ù†Ø¨Ø¯Ø£ Ø¨ØªÙ†ÙÙŠØ° Part 1.1ØŸ
