# ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø£Ù…Ø§Ù† Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„
**Project:** Cyber Zone GRC â€“ Romuz Awareness App  
**Document Version:** 1.0  
**Created:** 2025-11-19  
**Status:** Pending Implementation

---

## ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

1. [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©](#Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)
2. [Transaction Logging Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø­Ø±Ø¬Ø©](#transaction-logging-Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„-Ø§Ù„Ø­Ø±Ø¬Ø©)
3. [Backup Metadata ÙÙŠ ÙƒÙ„ Ù…ÙˆØ¯ÙŠÙˆÙ„](#backup-metadata-ÙÙŠ-ÙƒÙ„-Ù…ÙˆØ¯ÙŠÙˆÙ„)
4. [Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø³ÙŠØ§Ø³Ø§Øª RLS](#Ù…Ø±Ø§Ø¬Ø¹Ø©-Ø´Ø§Ù…Ù„Ø©-Ù„Ø³ÙŠØ§Ø³Ø§Øª-rls)
5. [Unified Audit Trail](#unified-audit-trail)
6. [Unified Security Validation](#unified-security-validation)
7. [Unified Error Handling](#unified-error-handling)
8. [Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚](#Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©-Ø§Ù„ØªØ·Ø¨ÙŠÙ‚)
9. [Ø§Ø¹ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡](#Ø§Ø¹ØªØ¨Ø§Ø±Ø§Øª-Ø§Ù„Ø£Ø¯Ø§Ø¡)
10. [Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª](#Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©-ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª)

---

## ğŸ¯ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

### Ø§Ù„Ù‡Ø¯Ù
ØªÙˆØ­ÙŠØ¯ ÙˆØªØ­Ø³ÙŠÙ† Ø¢Ù„ÙŠØ§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø£Ù…Ø§Ù† Ø¹Ø¨Ø± Ø¬Ù…ÙŠØ¹ Ù…ÙˆØ¯ÙŠÙˆÙ„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø·Ø¨Ù‚Ø© ÙÙŠ **M23 - Backup & Recovery System**.

### Ø§Ù„Ù†Ø·Ø§Ù‚
- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø­Ø±Ø¬Ø© Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„Ø§Øª Ø§Ù„ØªÙŠ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
- ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø¹Ø¨Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø£ÙƒÙ…Ù„Ù‡

### Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©
âœ… Ø­Ù…Ø§ÙŠØ© Ø£ÙØ¶Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©  
âœ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Point-in-Time Recovery)  
âœ… Ù…Ø³Ø§Ø± ØªØ¯Ù‚ÙŠÙ‚ Ù…ÙˆØ­Ø¯ ÙˆØ´Ø§Ù…Ù„  
âœ… Ø£Ù…Ø§Ù† Ù…Ø­Ø³Ù‘Ù† Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ RLS  
âœ… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ù…ØªØ³Ù‚Ø©  
âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…ÙˆØ­Ø¯

---

## ğŸ” Transaction Logging Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø­Ø±Ø¬Ø©

### 1.1 Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø°Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©

#### Policies Module (D2)
```sql
-- Enable transaction logging for policies table
CREATE TRIGGER policies_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON policies
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();

-- Enable transaction logging for policy_versions
CREATE TRIGGER policy_versions_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON policy_versions
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();

-- Enable transaction logging for policy_approvals
CREATE TRIGGER policy_approvals_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON policy_approvals
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();
```

#### GRC Risks Module (D4)
```sql
-- Enable transaction logging for grc_risks table
CREATE TRIGGER grc_risks_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON grc_risks
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();

-- Enable transaction logging for risk_assessments
CREATE TRIGGER risk_assessments_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON risk_assessments
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();

-- Enable transaction logging for risk_treatments
CREATE TRIGGER risk_treatments_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON risk_treatments
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();
```

#### Documents Module (D5)
```sql
-- Enable transaction logging for documents table
CREATE TRIGGER documents_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON documents
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();

-- Enable transaction logging for document_versions
CREATE TRIGGER document_versions_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON document_versions
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();
```

#### GRC Audits Module (D6)
```sql
-- Enable transaction logging for grc_audits table
CREATE TRIGGER grc_audits_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON grc_audits
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();

-- Enable transaction logging for audit_findings
CREATE TRIGGER audit_findings_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON audit_findings
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();
```

#### Committees & Meetings Module (D7)
```sql
-- Enable transaction logging for committees table
CREATE TRIGGER committees_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON committees
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();

-- Enable transaction logging for meetings
CREATE TRIGGER meetings_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON meetings
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();

-- Enable transaction logging for decisions
CREATE TRIGGER decisions_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON decisions
  FOR EACH ROW
  EXECUTE FUNCTION log_table_changes();
```

### 1.2 Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚

**Pre-requisites:**
- Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ø¯ÙˆÙ„ `backup_transaction_logs` (Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ M23)
- Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ù„Ø© `log_table_changes()` (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ M23)

**Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°:**
1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø­Ø±Ø¬Ø© ÙÙŠ ÙƒÙ„ Ù…ÙˆØ¯ÙŠÙˆÙ„
2. Ø¥Ù†Ø´Ø§Ø¡ Triggers Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
3. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù€ Triggers Ù…Ø¹ Ø¹Ù…Ù„ÙŠØ§Øª CRUD
4. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ `backup_transaction_logs`

---

## ğŸ’¾ Backup Metadata ÙÙŠ ÙƒÙ„ Ù…ÙˆØ¯ÙŠÙˆÙ„

### 2.1 Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Backup Metadata

**Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©:**
- `policies`
- `grc_risks`
- `documents`
- `grc_audits`
- `committees`
- `meetings`
- `objectives`
- `strategic_plans`

### 2.2 Migration Pattern

```sql
-- Example for policies table
ALTER TABLE policies 
ADD COLUMN last_backed_up_at TIMESTAMPTZ DEFAULT NULL;

-- Add index for performance
CREATE INDEX idx_policies_last_backed_up 
ON policies(tenant_id, last_backed_up_at) 
WHERE last_backed_up_at IS NOT NULL;

-- Add comment
COMMENT ON COLUMN policies.last_backed_up_at IS 
'Timestamp of the last successful backup for this record';
```

### 2.3 ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø­Ø±Ø¬Ø©

```sql
-- Policies Module
ALTER TABLE policies ADD COLUMN last_backed_up_at TIMESTAMPTZ;
ALTER TABLE policy_versions ADD COLUMN last_backed_up_at TIMESTAMPTZ;

-- GRC Risks Module
ALTER TABLE grc_risks ADD COLUMN last_backed_up_at TIMESTAMPTZ;
ALTER TABLE risk_assessments ADD COLUMN last_backed_up_at TIMESTAMPTZ;

-- Documents Module
ALTER TABLE documents ADD COLUMN last_backed_up_at TIMESTAMPTZ;
ALTER TABLE document_versions ADD COLUMN last_backed_up_at TIMESTAMPTZ;

-- GRC Audits Module
ALTER TABLE grc_audits ADD COLUMN last_backed_up_at TIMESTAMPTZ;
ALTER TABLE audit_findings ADD COLUMN last_backed_up_at TIMESTAMPTZ;

-- Committees Module
ALTER TABLE committees ADD COLUMN last_backed_up_at TIMESTAMPTZ;
ALTER TABLE meetings ADD COLUMN last_backed_up_at TIMESTAMPTZ;

-- Objectives Module
ALTER TABLE objectives ADD COLUMN last_backed_up_at TIMESTAMPTZ;
ALTER TABLE kpis ADD COLUMN last_backed_up_at TIMESTAMPTZ;
```

### 2.4 Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Backup Metadata

```sql
-- Function to update backup metadata after successful backup
CREATE OR REPLACE FUNCTION update_backup_metadata(
  p_table_name TEXT,
  p_tenant_id UUID
)
RETURNS INTEGER
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  v_updated_count INTEGER;
  v_query TEXT;
BEGIN
  -- Build dynamic query
  v_query := format(
    'UPDATE %I SET last_backed_up_at = NOW() WHERE tenant_id = $1',
    p_table_name
  );
  
  -- Execute and get count
  EXECUTE v_query USING p_tenant_id;
  GET DIAGNOSTICS v_updated_count = ROW_COUNT;
  
  RETURN v_updated_count;
END;
$$;
```

---

## ğŸ›¡ï¸ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø³ÙŠØ§Ø³Ø§Øª RLS

### 3.1 Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ù…ÙˆØ­Ø¯ Ù„Ø³ÙŠØ§Ø³Ø§Øª RLS

**Template Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„:**

```sql
-- 1. Enable RLS
ALTER TABLE {table_name} ENABLE ROW LEVEL SECURITY;

-- 2. SELECT Policy (Read)
CREATE POLICY "{table_name}_tenant_isolation_select"
ON {table_name}
FOR SELECT
TO authenticated
USING (tenant_id = public.get_user_tenant_id(auth.uid()));

-- 3. INSERT Policy (Create)
CREATE POLICY "{table_name}_tenant_isolation_insert"
ON {table_name}
FOR INSERT
TO authenticated
WITH CHECK (tenant_id = public.get_user_tenant_id(auth.uid()));

-- 4. UPDATE Policy (Update)
CREATE POLICY "{table_name}_tenant_isolation_update"
ON {table_name}
FOR UPDATE
TO authenticated
USING (tenant_id = public.get_user_tenant_id(auth.uid()))
WITH CHECK (tenant_id = public.get_user_tenant_id(auth.uid()));

-- 5. DELETE Policy (Delete)
CREATE POLICY "{table_name}_tenant_isolation_delete"
ON {table_name}
FOR DELETE
TO authenticated
USING (tenant_id = public.get_user_tenant_id(auth.uid()));
```

### 3.2 Ø¯Ø§Ù„Ø© Security Definer Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Tenant

```sql
-- Helper function to get user's tenant_id (if not exists)
CREATE OR REPLACE FUNCTION public.get_user_tenant_id(p_user_id UUID)
RETURNS UUID
LANGUAGE sql
SECURITY DEFINER
STABLE
SET search_path = public
AS $$
  SELECT tenant_id
  FROM user_tenants
  WHERE user_id = p_user_id
  LIMIT 1;
$$;
```

### 3.3 Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© RLS

**High Priority:**
- âœ… `policies` â†’ ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ RLS ÙƒØ§Ù…Ù„
- âœ… `grc_risks` â†’ ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ RLS ÙƒØ§Ù…Ù„
- âœ… `documents` â†’ ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ RLS ÙƒØ§Ù…Ù„
- âœ… `grc_audits` â†’ ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ RLS ÙƒØ§Ù…Ù„
- âœ… `committees` â†’ ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ RLS ÙƒØ§Ù…Ù„
- âœ… `meetings` â†’ ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ RLS ÙƒØ§Ù…Ù„

**Medium Priority:**
- âš ï¸ `objectives` â†’ Ù…Ø±Ø§Ø¬Ø¹Ø©
- âš ï¸ `kpis` â†’ Ù…Ø±Ø§Ø¬Ø¹Ø©
- âš ï¸ `strategic_plans` â†’ Ù…Ø±Ø§Ø¬Ø¹Ø©
- âš ï¸ `action_plans` â†’ Ù…Ø±Ø§Ø¬Ø¹Ø©

### 3.4 Script Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† RLS

```sql
-- Check tables without RLS enabled
SELECT 
  schemaname,
  tablename,
  rowsecurity
FROM pg_tables
WHERE schemaname = 'public'
  AND rowsecurity = false
ORDER BY tablename;

-- Check tables without policies
SELECT 
  t.tablename,
  COUNT(p.policyname) as policy_count
FROM pg_tables t
LEFT JOIN pg_policies p ON p.tablename = t.tablename
WHERE t.schemaname = 'public'
  AND t.rowsecurity = true
GROUP BY t.tablename
HAVING COUNT(p.policyname) < 4
ORDER BY policy_count, t.tablename;
```

---

## ğŸ“ Unified Audit Trail

### 4.1 Ø¯Ø§Ù„Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„ØªØ¯Ù‚ÙŠÙ‚

**Ù…Ù„Ù: `src/lib/audit/audit-logger.ts`**

```typescript
/**
 * Unified Audit Trail System
 * Consistent audit logging across all modules
 */

import { supabase } from '@/integrations/supabase/client';

export interface AuditLogEntry {
  entityType: string;
  entityId: string;
  action: 'create' | 'read' | 'update' | 'delete' | 'approve' | 'reject' | 'archive';
  payload?: Record<string, any>;
}

/**
 * Log an audit action to the audit_log table
 */
export async function logAuditAction(entry: AuditLogEntry): Promise<void> {
  try {
    // Get current user
    const { data: { user } } = await supabase.auth.getUser();
    
    if (!user) {
      console.warn('[Audit] No authenticated user, skipping audit log');
      return;
    }

    // Get tenant_id from user_tenants
    const { data: userTenant } = await supabase
      .from('user_tenants')
      .select('tenant_id')
      .eq('user_id', user.id)
      .single();

    if (!userTenant?.tenant_id) {
      console.warn('[Audit] No tenant found for user, skipping audit log');
      return;
    }

    // Insert audit log entry
    const { error } = await supabase
      .from('audit_log')
      .insert({
        tenant_id: userTenant.tenant_id,
        actor: user.id,
        entity_type: entry.entityType,
        entity_id: entry.entityId,
        action: entry.action,
        payload: entry.payload || {},
      });

    if (error) {
      console.error('[Audit] Failed to log audit entry:', error);
    }
  } catch (error) {
    console.error('[Audit] Unexpected error:', error);
  }
}

/**
 * Module-specific audit helpers
 */

// Policies Module
export const logPolicyAction = (
  policyId: string,
  action: 'create' | 'read' | 'update' | 'delete' | 'approve',
  payload?: Record<string, any>
) => logAuditAction({ entityType: 'policy', entityId: policyId, action, payload });

// GRC Risks Module
export const logRiskAction = (
  riskId: string,
  action: 'create' | 'read' | 'update' | 'delete',
  payload?: Record<string, any>
) => logAuditAction({ entityType: 'risk', entityId: riskId, action, payload });

// Documents Module
export const logDocumentAction = (
  documentId: string,
  action: 'create' | 'read' | 'update' | 'delete' | 'archive',
  payload?: Record<string, any>
) => logAuditAction({ entityType: 'document', entityId: documentId, action, payload });

// GRC Audits Module
export const logAuditAction_GRC = (
  auditId: string,
  action: 'create' | 'read' | 'update' | 'delete',
  payload?: Record<string, any>
) => logAuditAction({ entityType: 'grc_audit', entityId: auditId, action, payload });

// Committees Module
export const logCommitteeAction = (
  committeeId: string,
  action: 'create' | 'read' | 'update' | 'delete',
  payload?: Record<string, any>
) => logAuditAction({ entityType: 'committee', entityId: committeeId, action, payload });

// Meetings Module
export const logMeetingAction = (
  meetingId: string,
  action: 'create' | 'read' | 'update' | 'delete',
  payload?: Record<string, any>
) => logAuditAction({ entityType: 'meeting', entityId: meetingId, action, payload });

// Objectives Module
export const logObjectiveAction = (
  objectiveId: string,
  action: 'create' | 'read' | 'update' | 'delete',
  payload?: Record<string, any>
) => logAuditAction({ entityType: 'objective', entityId: objectiveId, action, payload });
```

### 4.2 Ø§Ø³ØªØ®Ø¯Ø§Ù… Audit Logger ÙÙŠ Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„Ø§Øª

**Ù…Ø«Ø§Ù„: Policies Module**

```typescript
// In src/integrations/supabase/policies.ts
import { logPolicyAction } from '@/lib/audit/audit-logger';

export async function createPolicy(policy: CreatePolicyInput) {
  const { data, error } = await supabase
    .from('policies')
    .insert(policy)
    .select()
    .single();

  if (error) throw error;

  // Log audit trail
  await logPolicyAction(data.id, 'create', { 
    title: policy.title,
    code: policy.code 
  });

  return data;
}

export async function updatePolicy(id: string, updates: UpdatePolicyInput) {
  const { data, error } = await supabase
    .from('policies')
    .update(updates)
    .eq('id', id)
    .select()
    .single();

  if (error) throw error;

  // Log audit trail
  await logPolicyAction(id, 'update', { 
    changes: updates 
  });

  return data;
}

export async function deletePolicy(id: string) {
  const { error } = await supabase
    .from('policies')
    .delete()
    .eq('id', id);

  if (error) throw error;

  // Log audit trail
  await logPolicyAction(id, 'delete');
}
```

---

## âœ… Unified Security Validation

### 5.1 Validation Schemas Ø§Ù„Ù…ÙˆØ­Ø¯Ø©

**Ù…Ù„Ù: `src/lib/validation/common-schemas.ts`**

```typescript
import { z } from 'zod';

/**
 * Common validation schemas used across modules
 */

// UUID validation
export const uuidSchema = z.string().uuid({ message: 'Ù…Ø¹Ø±Ù‘Ù ØºÙŠØ± ØµØ§Ù„Ø­' });

// Tenant ID validation
export const tenantIdSchema = z.string().uuid({ message: 'Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± ØºÙŠØ± ØµØ§Ù„Ø­' });

// User ID validation
export const userIdSchema = z.string().uuid({ message: 'Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± ØµØ§Ù„Ø­' });

// Pagination schema
export const paginationSchema = z.object({
  page: z.number().int().positive().default(1),
  limit: z.number().int().positive().max(100).default(20),
});

// Date range schema
export const dateRangeSchema = z.object({
  startDate: z.string().datetime({ message: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ØºÙŠØ± ØµØ§Ù„Ø­' }),
  endDate: z.string().datetime({ message: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ØºÙŠØ± ØµØ§Ù„Ø­' }),
}).refine(
  (data) => new Date(data.startDate) <= new Date(data.endDate),
  { message: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©' }
);

// Status schema (generic)
export const statusSchema = z.enum([
  'draft',
  'active',
  'inactive',
  'archived',
  'pending',
  'approved',
  'rejected',
]);

// Arabic text validation
export const arabicTextSchema = (fieldName: string, maxLength: number = 500) =>
  z.string()
    .trim()
    .min(1, { message: `${fieldName} Ù…Ø·Ù„ÙˆØ¨` })
    .max(maxLength, { message: `${fieldName} ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† ${maxLength} Ø­Ø±Ù` });

// Code validation (alphanumeric + dash/underscore)
export const codeSchema = (fieldName: string = 'Ø§Ù„Ø±Ù…Ø²') =>
  z.string()
    .trim()
    .min(2, { message: `${fieldName} ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø­Ø±ÙÙŠÙ†` })
    .max(50, { message: `${fieldName} ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 50 Ø­Ø±Ù` })
    .regex(/^[a-zA-Z0-9_-]+$/, { 
      message: `${fieldName} ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø­Ø±ÙˆÙ ÙˆØ£Ø±Ù‚Ø§Ù… ÙˆØ´Ø±Ø·Ø©` 
    });
```

### 5.2 Module-Specific Schemas

**Ù…Ø«Ø§Ù„: Policies Module Validation**

**Ù…Ù„Ù: `src/lib/validation/policy-schemas.ts`**

```typescript
import { z } from 'zod';
import { 
  tenantIdSchema, 
  userIdSchema, 
  arabicTextSchema, 
  codeSchema,
  statusSchema 
} from './common-schemas';

/**
 * Policy validation schemas
 */

export const policySchema = z.object({
  tenant_id: tenantIdSchema,
  code: codeSchema('Ø±Ù…Ø² Ø§Ù„Ø³ÙŠØ§Ø³Ø©'),
  title: arabicTextSchema('Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙŠØ§Ø³Ø©', 200),
  description: arabicTextSchema('ÙˆØµÙ Ø§Ù„Ø³ÙŠØ§Ø³Ø©', 2000).optional(),
  status: statusSchema,
  owner_id: userIdSchema.optional(),
  approved_by: userIdSchema.optional(),
  approved_at: z.string().datetime().optional(),
  effective_date: z.string().date({ message: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù† ØºÙŠØ± ØµØ§Ù„Ø­' }),
  review_date: z.string().date({ message: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ØºÙŠØ± ØµØ§Ù„Ø­' }).optional(),
}).refine(
  (data) => {
    if (data.review_date && data.effective_date) {
      return new Date(data.effective_date) < new Date(data.review_date);
    }
    return true;
  },
  { 
    message: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø±ÙŠØ§Ù†',
    path: ['review_date']
  }
);

export const createPolicySchema = policySchema.omit({ 
  tenant_id: true // Will be set automatically
});

export const updatePolicySchema = policySchema.partial().omit({ 
  tenant_id: true,
  code: true // Cannot update code
});

export type PolicyInput = z.infer<typeof policySchema>;
export type CreatePolicyInput = z.infer<typeof createPolicySchema>;
export type UpdatePolicyInput = z.infer<typeof updatePolicySchema>;
```

### 5.3 Ø§Ø³ØªØ®Ø¯Ø§Ù… Validation ÙÙŠ Integration Layer

```typescript
// In src/integrations/supabase/policies.ts
import { createPolicySchema, updatePolicySchema } from '@/lib/validation/policy-schemas';
import { showErrorToast } from '@/lib/errors/errorHandler';

export async function createPolicy(input: unknown) {
  // Validate input
  const validationResult = createPolicySchema.safeParse(input);
  
  if (!validationResult.success) {
    const firstError = validationResult.error.errors[0];
    showErrorToast(
      new Error(firstError.message),
      'ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ø³Ø©'
    );
    throw new Error(firstError.message);
  }

  const validData = validationResult.data;

  // Get tenant_id
  const { data: userTenant } = await supabase
    .from('user_tenants')
    .select('tenant_id')
    .single();

  if (!userTenant) {
    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±');
  }

  // Insert with validated data
  const { data, error } = await supabase
    .from('policies')
    .insert({
      ...validData,
      tenant_id: userTenant.tenant_id,
    })
    .select()
    .single();

  if (error) throw error;

  // Log audit
  await logPolicyAction(data.id, 'create', { 
    title: data.title,
    code: data.code 
  });

  return data;
}
```

---

## âš ï¸ Unified Error Handling

### 6.1 ØªÙˆØ³ÙŠØ¹ Error Handler Ø§Ù„Ø­Ø§Ù„ÙŠ

**ØªØ­Ø¯ÙŠØ«: `src/lib/errors/errorHandler.ts`**

```typescript
/**
 * Enhanced Error Handling for Database Operations
 */

import { PostgrestError } from '@supabase/supabase-js';

/**
 * Parse database-specific errors
 */
export function parseDatabaseError(error: PostgrestError): AppError {
  const message = error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
  const code = error.code;

  // RLS violation (42501)
  if (code === '42501' || message.includes('policy')) {
    return new AppError(
      'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
      ErrorType.PERMISSION,
      error
    );
  }

  // Foreign key violation (23503)
  if (code === '23503' || message.includes('foreign key')) {
    return new AppError(
      'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ - ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡',
      ErrorType.VALIDATION,
      error
    );
  }

  // Unique violation (23505)
  if (code === '23505' || message.includes('unique') || message.includes('duplicate')) {
    return new AppError(
      'Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„',
      ErrorType.DUPLICATE,
      error
    );
  }

  // Not null violation (23502)
  if (code === '23502' || message.includes('null value')) {
    return new AppError(
      'Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…ÙÙ‚ÙˆØ¯Ø©',
      ErrorType.VALIDATION,
      error
    );
  }

  // Check constraint violation (23514)
  if (code === '23514' || message.includes('check constraint')) {
    return new AppError(
      'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù„Ø§ ØªØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©',
      ErrorType.VALIDATION,
      error
    );
  }

  // Timeout (57014)
  if (code === '57014' || message.includes('timeout')) {
    return new AppError(
      'Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ© - ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰',
      ErrorType.NETWORK,
      error
    );
  }

  // Connection error (08000-08006)
  if (code?.startsWith('08')) {
    return new AppError(
      'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
      ErrorType.NETWORK,
      error
    );
  }

  return new AppError(message, ErrorType.UNKNOWN, error);
}

/**
 * Handle database errors with specific context
 */
export function handleDatabaseError(
  error: unknown, 
  operation: string,
  entityType?: string
): AppError {
  let appError: AppError;

  if (error && typeof error === 'object' && 'code' in error) {
    appError = parseDatabaseError(error as PostgrestError);
  } else if (error instanceof AppError) {
    appError = error;
  } else if (error instanceof Error) {
    appError = new AppError(error.message, ErrorType.UNKNOWN, error);
  } else {
    appError = new AppError('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹', ErrorType.UNKNOWN);
  }

  // Enhanced context
  const contextMessage = entityType 
    ? `${operation} - ${entityType}`
    : operation;

  // Log in development
  if (import.meta.env.DEV) {
    console.error(`[Database Error] ${contextMessage}`, {
      type: appError.type,
      message: appError.message,
      details: appError.details,
    });
  }

  return appError;
}
```

### 6.2 Ø§Ø³ØªØ®Ø¯Ø§Ù… Error Handler ÙÙŠ Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„Ø§Øª

```typescript
// Example in policies integration
import { handleDatabaseError, showErrorToast } from '@/lib/errors/errorHandler';

export async function createPolicy(input: CreatePolicyInput) {
  try {
    // ... validation and database operation
  } catch (error) {
    const appError = handleDatabaseError(
      error, 
      'Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©',
      'policy'
    );
    
    showErrorToast(appError, 'ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ø³Ø©');
    throw appError;
  }
}

export async function deletePolicy(id: string) {
  try {
    // ... database operation
  } catch (error) {
    const appError = handleDatabaseError(
      error, 
      'Ø­Ø°Ù Ø³ÙŠØ§Ø³Ø©',
      'policy'
    );
    
    showErrorToast(appError, 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø³Ø©');
    throw appError;
  }
}
```

---

## ğŸ“… Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚

### 7.1 Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø­Ø±Ø¬Ø© (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1-2)

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©:**
- âœ… `policies` + `policy_versions` + `policy_approvals`
- âœ… `grc_risks` + `risk_assessments` + `risk_treatments`
- âœ… `documents` + `document_versions`
- âœ… `grc_audits` + `audit_findings`

**Ø§Ù„Ù…Ù‡Ø§Ù…:**
1. Ø¥Ø¶Ø§ÙØ© Transaction Logging
2. Ø¥Ø¶Ø§ÙØ© Backup Metadata
3. Ù…Ø±Ø§Ø¬Ø¹Ø© RLS Policies
4. ØªØ·Ø¨ÙŠÙ‚ Unified Audit Trail
5. ØªØ·Ø¨ÙŠÙ‚ Unified Validation
6. ØªØ·Ø¨ÙŠÙ‚ Unified Error Handling

### 7.2 Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3-4)

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©:**
- âš ï¸ `committees` + `committee_members`
- âš ï¸ `meetings` + `agenda_items` + `decisions`
- âš ï¸ `objectives` + `kpis` + `initiatives`
- âš ï¸ `strategic_plans` + `action_plans`

**Ø§Ù„Ù…Ù‡Ø§Ù…:** Ù†ÙØ³ Ø§Ù„Ù…Ù‡Ø§Ù… Ø£Ø¹Ù„Ø§Ù‡

### 7.3 Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 5-6)

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©:**
- ğŸ“‹ `attachments`
- ğŸ“‹ `notifications`
- ğŸ“‹ Ø¬Ø¯Ø§ÙˆÙ„ Ø£Ø®Ø±Ù‰ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©

**Ø§Ù„Ù…Ù‡Ø§Ù…:** Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© ÙˆØ§Ù„Ø­Ø§Ø¬Ø©

---

## ğŸš€ Ø§Ø¹ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡

### 8.1 Indexes Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©

**Ù„ÙƒÙ„ Ø¬Ø¯ÙˆÙ„ Ø­Ø±Ø¬:**

```sql
-- Primary performance indexes
CREATE INDEX idx_{table}_tenant_created 
ON {table}(tenant_id, created_at DESC);

CREATE INDEX idx_{table}_tenant_status 
ON {table}(tenant_id, status) 
WHERE status != 'archived';

CREATE INDEX idx_{table}_last_backed_up 
ON {table}(tenant_id, last_backed_up_at) 
WHERE last_backed_up_at IS NOT NULL;

-- Full-text search (if applicable)
CREATE INDEX idx_{table}_search 
ON {table} USING GIN(to_tsvector('arabic', title || ' ' || COALESCE(description, '')));
```

**Ù…Ø«Ø§Ù„: Policies**

```sql
-- Performance indexes for policies table
CREATE INDEX idx_policies_tenant_created 
ON policies(tenant_id, created_at DESC);

CREATE INDEX idx_policies_tenant_status 
ON policies(tenant_id, status) 
WHERE status != 'archived';

CREATE INDEX idx_policies_tenant_code 
ON policies(tenant_id, code);

CREATE INDEX idx_policies_last_backed_up 
ON policies(tenant_id, last_backed_up_at) 
WHERE last_backed_up_at IS NOT NULL;

CREATE INDEX idx_policies_search 
ON policies USING GIN(
  to_tsvector('arabic', title || ' ' || COALESCE(description, ''))
);
```

### 8.2 Query Optimization

**Ø§Ø³ØªØ®Ø¯Ø§Ù… Prepared Statements:**

```typescript
// Use consistent query patterns for caching
export async function getPoliciesByStatus(status: string) {
  const { data, error } = await supabase
    .from('policies')
    .select('*')
    .eq('status', status)
    .order('created_at', { ascending: false });

  if (error) throw handleDatabaseError(error, 'Ø¬Ù„Ø¨ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª', 'policy');
  return data;
}
```

**Ø§Ø³ØªØ®Ø¯Ø§Ù… React Query Ù„Ù„Ù€ Caching:**

```typescript
// In hooks/usePolicies.ts
import { useQuery } from '@tanstack/react-query';

export function usePolicies(status?: string) {
  return useQuery({
    queryKey: ['policies', status],
    queryFn: () => getPoliciesByStatus(status),
    staleTime: 5 * 60 * 1000, // 5 minutes
    gcTime: 10 * 60 * 1000, // 10 minutes
  });
}
```

---

## ğŸ“Š Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª

### 9.1 Metrics Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©

**Ù„ÙƒÙ„ Ù…ÙˆØ¯ÙŠÙˆÙ„:**

```typescript
// src/lib/monitoring/module-health.ts

export interface ModuleHealthMetrics {
  moduleName: string;
  totalRecords: number;
  recordsBackedUp: number;
  recordsNotBackedUp: number;
  lastBackupAt: string | null;
  oldestUnbackedRecord: string | null;
  auditLogCount: number;
  lastAuditAt: string | null;
  riskLevel: 'low' | 'medium' | 'high' | 'critical';
}

export async function getModuleHealth(
  tableName: string,
  moduleName: string
): Promise<ModuleHealthMetrics> {
  // Implementation for fetching module health metrics
  // This would query the table and backup metadata
}
```

### 9.2 Dashboard Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©

**Ù…Ù‚ØªØ±Ø­: Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø© Module Health Dashboard**

- Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„ÙƒÙ„ Ù…ÙˆØ¯ÙŠÙˆÙ„
- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØªÙŠ Ù„Ù… ÙŠØªÙ… Ù†Ø³Ø®Ù‡Ø§ Ø§Ø­ØªÙŠØ§Ø·ÙŠØ§Ù‹ Ù„ÙØªØ±Ø© Ø·ÙˆÙŠÙ„Ø©
- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Audit Trail
- Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ (Performance Metrics)

---

## âœ… Checklist Ù„Ù„ØªØ·Ø¨ÙŠÙ‚

### Per Module Checklist

```markdown
## Module: {Module Name}

### Transaction Logging
- [ ] ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø­Ø±Ø¬Ø©
- [ ] Ø¥Ø¶Ø§ÙØ© Triggers Ù„Ù„ØªØ³Ø¬ÙŠÙ„
- [ ] Ø§Ø®ØªØ¨Ø§Ø± Triggers
- [ ] Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ backup_transaction_logs

### Backup Metadata
- [ ] Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ last_backed_up_at
- [ ] Ø¥Ø¶Ø§ÙØ© Indexes
- [ ] ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ

### RLS Policies
- [ ] Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙØ¹ÙŠÙ„ RLS Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
- [ ] Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ 4 Ø³ÙŠØ§Ø³Ø§Øª (SELECT, INSERT, UPDATE, DELETE)
- [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø²Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ÙŠÙ† Tenants
- [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª

### Unified Audit Trail
- [ ] ØªØ·Ø¨ÙŠÙ‚ logAuditAction ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
- [ ] Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø¬ÙŠÙ„ CRUD operations
- [ ] Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ audit_log

### Unified Validation
- [ ] Ø¥Ù†Ø´Ø§Ø¡ Validation Schemas
- [ ] ØªØ·Ø¨ÙŠÙ‚ Validation ÙÙŠ Integration Layer
- [ ] Ø§Ø®ØªØ¨Ø§Ø± Validation Errors
- [ ] ØªØ­Ø¯ÙŠØ« Error Messages

### Unified Error Handling
- [ ] Ø§Ø³ØªØ®Ø¯Ø§Ù… handleDatabaseError
- [ ] Ø§Ø³ØªØ®Ø¯Ø§Ù… showErrorToast
- [ ] Ø§Ø®ØªØ¨Ø§Ø± Error Scenarios
- [ ] Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Error Messages

### Performance
- [ ] Ø¥Ø¶Ø§ÙØ© Indexes Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
- [ ] ØªØ­Ø³ÙŠÙ† Queries
- [ ] Ø¥Ø¶Ø§ÙØ© React Query Caching
- [ ] Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯

### Documentation
- [ ] ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
- [ ] ØªØ­Ø¯ÙŠØ« API Documentation
- [ ] Ø¥Ø¶Ø§ÙØ© Ø£Ù…Ø«Ù„Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
```

---

## ğŸ“š Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹

1. **M23 - Backup & Recovery System**
   - `docs/awareness/04_Execution/M23_Complete_Review_Report.md`
   - `supabase/migrations/` (Backup migrations)
   - `src/integrations/supabase/backup.ts`

2. **Project Guidelines**
   - `docs/awareness/00_General/ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¹Ø§Ù…Ø©.md`
   - `docs/awareness/06_Execution/Project_Completion_Roadmap_v1.0.md`

3. **Security Best Practices**
   - Row-Level Security (RLS)
   - OWASP Top 10
   - PDPL Compliance

4. **Performance Best Practices**
   - Database Indexing Strategies
   - Query Optimization
   - Caching Strategies

---

## ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ©

### Ù†Ù‚Ø§Ø· Ù…Ù‡Ù…Ø©
1. **Ù„Ø§ ØªØ³Ø±Ø¹ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚** - Ø§ØªØ¨Ø¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨
2. **Ø§Ø®ØªØ¨Ø± ÙƒÙ„ ØªØºÙŠÙŠØ±** - Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªØ§Ù„ÙŠ
3. **Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø£Ø¯Ø§Ø¡** - Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
4. **ÙˆØ«Ù‘Ù‚ ÙƒÙ„ Ø´ÙŠØ¡** - Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©

### Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
- Ù„Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ©: Ø±Ø§Ø¬Ø¹ M23 Implementation
- Ù„Ù„ØªÙˆØ¶ÙŠØ­Ø§Øª: Ø±Ø§Ø¬Ø¹ Project Guidelines
- Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: Ø±Ø§Ø¬Ø¹ Integration Tests ÙÙŠ M23

---

**Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©**

**Ø§Ù„ØªØ§Ù„ÙŠ:** Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ (ÙŠÙÙ†ØµØ­ Ø¨Ù€ Policies Module - D2)
