# ๐ ุฏููู ุงูุชุดุบูู ุงูุณุฑูุน ูุงุฎุชุจุงุฑุงุช E2E

## โ ุงูุฎุทูุงุช ุงููุทููุจุฉ

### 1๏ธโฃ ุชุซุจูุช Playwright
```bash
npm install -D @playwright/test
npx playwright install
```

### 2๏ธโฃ ุฅุนุฏุงุฏ ููู ุงูุจูุฆุฉ `.env.test`
ุฃูุดุฆ ููู `.env.test` ูู ุงูุฌุฐุฑ:
```env
E2E_BASE_URL=http://localhost:5173
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_PUBLISHABLE_KEY=your_anon_key

# ุจูุงูุงุช ุงููุณุชุฎุฏููู ููุงุฎุชุจุงุฑ
E2E_ADMIN_EMAIL=admin@test.com
E2E_ADMIN_PASSWORD=Test@123456
E2E_MANAGER_EMAIL=manager@test.com
E2E_MANAGER_PASSWORD=Test@123456
E2E_READER_EMAIL=reader@test.com
E2E_READER_PASSWORD=Test@123456
E2E_TENANT_ID=e2e-test-tenant-001
```

### 3๏ธโฃ ุฅูุดุงุก ูุณุชุฎุฏูู ุงูุงุฎุชุจุงุฑ
ุงุณุชุฎุฏู ุงูุณูุฑูุจุช `tests/e2e/seed-test-users.sql` ูุฅูุดุงุก:
- Tenant: `e2e-test-tenant-001`
- Admin: `admin@test.com` ูุน ุตูุงุญูุงุช ูุงููุฉ
- Manager: `manager@test.com` ูุน ุตูุงุญูุงุช ุฅุฏุงุฑูุฉ
- Reader: `reader@test.com` ูุน ุตูุงุญูุงุช ูุฑุงุกุฉ ููุท

### 4๏ธโฃ ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช

#### ุฃ) ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช
```bash
npx playwright test
```

#### ุจ) ุชุดุบูู ุงุฎุชุจุงุฑุงุช UI ููุท
```bash
./tests/e2e/run-tests.sh ui
```

#### ุฌ) ุชุดุบูู ุงุฎุชุจุงุฑุงุช API ููุท
```bash
./tests/e2e/run-tests.sh api
```

#### ุฏ) ุชุดุบูู ุงุฎุชุจุงุฑ ูุญุฏุฏ
```bash
./tests/e2e/run-tests.sh admin    # ุงุฎุชุจุงุฑ Admin Flow
./tests/e2e/run-tests.sh manager  # ุงุฎุชุจุงุฑ Manager Flow
./tests/e2e/run-tests.sh reader   # ุงุฎุชุจุงุฑ Reader RBAC
```

#### ูู) ูุถุน UI ุงูุชูุงุนูู
```bash
./tests/e2e/run-tests.sh ui-mode
```

#### ู) ูุถุน Debug
```bash
./tests/e2e/run-tests.sh debug
```

### 5๏ธโฃ ุนุฑุถ ุงููุชุงุฆุฌ

#### ุนุฑุถ ุงูุชูุฑูุฑ
```bash
npx playwright show-report test-results/html
```

#### ุนุฑุถ Trace ููุงุฎุชุจุงุฑุงุช ุงููุงุดูุฉ
```bash
npx playwright show-trace test-results/trace.zip
```

---

## ๐ ูุง ุงูุฐู ุชุฎุชุจุฑู ูุฐู ุงูุงุฎุชุจุงุฑุงุชุ

### โ Admin Flow (admin.flow.spec.ts)
- ุฅูุดุงุก ุญููุงุช ุฌุฏูุฏุฉ
- ุฅุฏุงุฑุฉ ุงููุดุงุฑููู (ุฅุถุงูุฉุ ุชุนุฏููุ ุญุฐู)
- ุฅุฏุงุฑุฉ ุงููุญุฏุงุช ุงูุชุฏุฑูุจูุฉ
- ุงูุจุญุซ ูุงูุชุตููุฉ
- ุงูุชุตุฏูุฑ ุฅูู CSV/Excel
- ุงูุชุญูููุงุช ูุงูุฅุญุตุงุฆูุงุช

### โ Manager Flow (manager.flow.spec.ts)
- ุนุฑุถ ูุชุญุฑูุฑ ุงูุญููุงุช
- ุนูููุงุช ูุฌูุนุฉ (Bulk Actions)
- ุงูุชุตุฏูุฑ ูุงูุชุตููุฉ
- ุงูุฅุญุตุงุฆูุงุช ุงููุญุฏูุฏุฉ

### โ Reader Flow (reader.flow.spec.ts)
- **RBAC Guards**: ุงูุชุฃูุฏ ูู ููุน ุงููุฑุงุกุฉ ูู:
  - ุฅูุดุงุก/ุชุนุฏูู/ุญุฐู ุงูุญููุงุช
  - ุฅูุดุงุก/ุชุนุฏูู/ุญุฐู ุงููุดุงุฑููู
  - ุงููุตูู ุฅูู ุงูุฅุนุฏุงุฏุงุช
- ุนุฑุถ ุงูุจูุงูุงุช ููุท

### โ API Tests
- `api.campaigns.spec.ts`: CRUD ููุญููุงุช + RLS
- `api.participants.spec.ts`: CRUD ูููุดุงุฑููู + RLS
- `api.savedviews.spec.ts`: ุญูุธ ูุงุณุชุฑุฌุงุน Views

---

## ๐ ูุตูููุฉ ุงูุตูุงุญูุงุช (RBAC Matrix)

| ุงููุธููุฉ | Admin | Manager | Reader |
|---------|-------|---------|--------|
| ุนุฑุถ ุงูุญููุงุช | โ | โ | โ |
| ุฅูุดุงุก ุญููุงุช | โ | โ | โ |
| ุชุนุฏูู ุญููุงุช | โ | โ | โ |
| ุญุฐู ุญููุงุช | โ | โ | โ |
| ุฅุฏุงุฑุฉ ุงููุดุงุฑููู | โ | โ | โ |
| ุงูุจุญุซ ูุงูุชุตููุฉ | โ | โ | โ |
| ุงูุชุตุฏูุฑ | โ | โ | โ |
| ุงูุชุญูููุงุช ุงููุงููุฉ | โ | ูุญุฏูุฏุฉ | ูุญุฏูุฏุฉ |
| ุงูุฅุนุฏุงุฏุงุช | โ | โ | โ |

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุงุฎุชุจุงุฑุงุช ุชูุดู ูู ุชุณุฌูู ุงูุฏุฎูู
**ุงูุญู**: ุชุฃูุฏ ูู:
1. ุจูุงูุงุช ุงููุณุชุฎุฏููู ูู `.env.test` ุตุญูุญุฉ
2. ุงููุณุชุฎุฏููู ููุฌูุฏูู ูู Supabase Auth
3. ุงููุณุชุฎุฏููู ูุฑุจูุทูู ุจู Tenant ุงูุตุญูุญ
4. RLS Policies ููุนูุฉ ุนูู ุงูุฌุฏุงูู

### ุงููุดููุฉ: ุฎุทุฃ "Element not found"
**ุงูุญู**: 
1. ุงุณุชุฎุฏู UI Mode ูุฑุคูุฉ ูุง ูุญุฏุซ: `./tests/e2e/run-tests.sh ui-mode`
2. ุชุญูู ูู Selectors ูู `tests/e2e/_helpers/selectors.ts`

### ุงููุดููุฉ: ุงูุงุฎุชุจุงุฑุงุช ุจุทูุฆุฉ
**ุงูุญู**:
1. ุดุบู ุงุฎุชุจุงุฑ ูุงุญุฏ ููุท: `./tests/e2e/run-tests.sh admin`
2. ุงุณุชุฎุฏู Workers: `npx playwright test --workers=4`

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชุดุบูู ุงููุญูู**: ุงูุงุฎุชุจุงุฑุงุช ุชุญุชุงุฌ ุชุดุบูู `npm run dev` ุฃููุงู
2. **CI/CD**: ูู ูุถุน CIุ ุงูุงุฎุชุจุงุฑุงุช ุชุดุชุบู ุจู `retries: 1`
3. **Isolation**: ูู ุงุฎุชุจุงุฑ ูุนุฒูู - ููุดุฆ ุจูุงูุงุช ุฌุฏูุฏุฉ
4. **Cleanup**: ูุง ุชูุณู ุชูุธูู ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ุฏูุฑููุง

---

## ๐ฏ ุงูุชุงูู ุจุนุฏ ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช

ุฅุฐุง ูุฌุญุช ุฌููุน ุงูุงุฎุชุจุงุฑุงุช โ:
- ููุตุฉ GRC ุฌุงูุฒุฉ ููุฅูุชุงุฌ
- RBAC ู RLS ูุนููุงู ุจุดูู ุตุญูุญ
- Multi-tenant isolation ูุญูู

ุฅุฐุง ูุดูุช ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช โ:
- ุฑุงุฌุน Trace ููุงุฎุชุจุงุฑ ุงููุงุดู
- ุชุญูู ูู Console logs
- ุฑุงุฌุน RLS Policies ู RBAC Guards
